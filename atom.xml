<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>EvanSun Home</title>
  
  <subtitle>记录、分享</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.jyusun.com/"/>
  <updated>2020-03-27T08:10:21.943Z</updated>
  <id>https://blog.jyusun.com/</id>
  
  <author>
    <name>evansun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kubernetes-08概念总结</title>
    <link href="https://blog.jyusun.com/contents/20200101181126.html"/>
    <id>https://blog.jyusun.com/contents/20200101181126.html</id>
    <published>2020-01-01T10:11:26.000Z</published>
    <updated>2020-03-27T08:10:21.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-08概念总结"><a href="#Kubernetes-08概念总结" class="headerlink" title="Kubernetes-08概念总结"></a>Kubernetes-08概念总结</h1><h2 id="什么是-Kubernetes"><a href="#什么是-Kubernetes" class="headerlink" title="什么是 Kubernetes"></a>什么是 Kubernetes</h2><p>Kubernetes 是一个开源的 Docker 容器编排系统，它可以调度计算集群的节点，动态管理上面的作业，保证它们按用户期望的状态运行。通过使用「labels」和「pods」的概念，Kubernetes 将应用按逻辑单元进行分组，方便管理和服务发现。</p><p>​    <img src="/contents/20200101181126/k8s-jiagou01.jpg" title="架构图"></p><ul><li><strong>pods：</strong> 是一组紧密关联的容器集合，它们共享 IPC(进程间通信)、Network(网络) 和 UTS namespace(UTS 命名空间是 Linux 命名空间的一个子系统，主要作用是完成对容器 Hostname 和 Domain 的隔离，同时保存内核名称、版本、以及底层体系结构类型等信息)，是 Kubernetes 调度的基本单位。</li><li><strong>labels：</strong> 键值对(key/value)标签，可以被关联到如 Pod 这样的对象上，主要作用是给用户一个直观的感受，比如这个 Pod 是用来放置数据库的</li><li><strong>GUI：</strong> 用户图形界面，可以是 Web 用户界面，比如使用 <code>kubernetes-dashboard</code> 组件，用户可以通过 Dashboard 在 Kubernetes 集群中部署容器化的应用，可以查看集群中应用的运行情况，同时也能够基于 Dashboard 创建或修改部署、任务、服务等 Kubernetes 的资源。通过部署向导，用户能够对部署进行扩缩容，进行滚动更新、重启 Pod 和部署新应用。当然，通过 Dashboard 也能够查看 Kubernetes 资源的状态</li><li><strong>kubectl：</strong> 用于管理 Kubernetes 集群的命令行工具</li><li><strong>kube-apiserver：</strong> 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制</li><li><strong>Kubernetes Master：</strong> Kubernetes 集群主节点，主要由 <code>kube-apiserver</code>、<code>kube-scheduler</code>、<code>kube-controller-manager</code>、<code>etcd</code> 四个模块组成</li><li><strong>Kubernetes Node：</strong> Kubernetes 集群子节点，主要由 <code>kubelet</code>、<code>kube-proxy</code>、<code>runtime</code> 三个模块组成</li><li><strong>Image Registry：</strong> 镜像仓库，比如：Ducker HUB 或 Docker 私服</li></ul><h2 id="Kubernetes-Master"><a href="#Kubernetes-Master" class="headerlink" title="Kubernetes Master"></a>Kubernetes Master</h2><p>​    <img src="/contents/20200101181126/k8s-jiagou02.jpg" title="架构图"></p><ul><li><strong>kube-apiserver：</strong> 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制</li><li><strong>kube-scheduler：</strong> 负责资源的调度，按照预定的调度策略将 Pod 调度到相应的机器上</li><li><strong>kube-controller-manager：</strong> 负责维护集群的状态，比如故障检测、自动扩展、滚动更新等</li><li><strong>etcd：</strong> CoreOS 基于 Raft 开发的分布式 key-value 存储，可用于服务发现、共享配置以及一致性保障（如数据库选主、分布式锁等）</li></ul><h2 id="Kubernetes-Node"><a href="#Kubernetes-Node" class="headerlink" title="Kubernetes Node"></a>Kubernetes Node</h2><p>​    <img src="/contents/20200101181126/k8s-jiagou03.jpg" title="架构图"></p><ul><li><strong>runtime：</strong> 负责镜像管理以及 Pod 和容器的真正运行（CRI，Container Runtime Interface），默认的容器运行时为 Docker，还支持 RKT 容器</li><li><strong>kubelet：</strong> 负责维持容器的生命周期，同时也负责 Volume（CVI，Container Volume Interface）和网络（CNI，Container Network Interface）的管理</li><li><strong>kube-proxy：</strong> 负责为 Service 提供 cluster 内部的服务发现和负载均衡</li></ul><h2 id="Kubernetes-架构"><a href="#Kubernetes-架构" class="headerlink" title="Kubernetes 架构"></a>Kubernetes 架构</h2><p>​    <img src="/contents/20200101181126/k8s-jiagou04.jpg" title="架构图"></p><p>​    <img src="/contents/20200101181126/k8s-jiagou05.jpg" title="架构图"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-08概念总结&quot;&gt;&lt;a href=&quot;#Kubernetes-08概念总结&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-08概念总结&quot;&gt;&lt;/a&gt;Kubernetes-08概念总结&lt;/h1&gt;&lt;h2 id=&quot;什么是-K
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-07配置网络</title>
    <link href="https://blog.jyusun.com/contents/20200101171126.html"/>
    <id>https://blog.jyusun.com/contents/20200101171126.html</id>
    <published>2020-01-01T09:11:26.000Z</published>
    <updated>2020-03-27T07:25:43.325Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-07配置网络"><a href="#Kubernetes-07配置网络" class="headerlink" title="Kubernetes-07配置网络"></a>Kubernetes-07配置网络</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>容器网络是容器选择连接到其他容器、主机和外部网络的机制。容器的 runtime 提供了各种网络模式，每种模式都会产生不同的体验。例如，Docker 默认情况下可以为容器配置以下网络：</p><ul><li><strong>none：</strong> 将容器添加到一个容器专门的网络堆栈中，没有对外连接。</li><li><strong>host：</strong> 将容器添加到主机的网络堆栈中，没有隔离。</li><li><strong>default bridge：</strong> 默认网络模式。每个容器可以通过 IP 地址相互连接。</li><li><strong>自定义网桥：</strong> 用户定义的网桥，具有更多的灵活性、隔离性和其他便利功能。</li></ul><h2 id="什么是-CNI"><a href="#什么是-CNI" class="headerlink" title="什么是 CNI"></a>什么是 CNI</h2><p>CNI(Container Network Interface) 是一个标准的，通用的接口。在容器平台，Docker，Kubernetes，Mesos 容器网络解决方案 flannel，calico，weave。只要提供一个标准的接口，就能为同样满足该协议的所有容器平台提供网络功能，而 CNI 正是这样的一个标准接口协议。</p><h2 id="Kubernetes-中的-CNI-插件"><a href="#Kubernetes-中的-CNI-插件" class="headerlink" title="Kubernetes 中的 CNI 插件"></a>Kubernetes 中的 CNI 插件</h2><p>CNI 的初衷是创建一个框架，用于在配置或销毁容器时动态配置适当的网络配置和资源。插件负责为接口配置和管理 IP 地址，并且通常提供与 IP 管理、每个容器的 IP 分配、以及多主机连接相关的功能。容器运行时会调用网络插件，从而在容器启动时分配 IP 地址并配置网络，并在删除容器时再次调用它以清理这些资源。</p><p>运行时或协调器决定了容器应该加入哪个网络以及它需要调用哪个插件。然后，插件会将接口添加到容器网络命名空间中，作为一个 veth 对的一侧。接着，它会在主机上进行更改，包括将 veth 的其他部分连接到网桥。再之后，它会通过调用单独的 IPAM（IP地址管理）插件来分配 IP 地址并设置路由。</p><p>在 Kubernetes 中，kubelet 可以在适当的时间调用它找到的插件，为通过 kubelet 启动的 pod进行自动的网络配置。</p><p>Kubernetes 中可选的 CNI 插件如下：</p><ul><li>Flannel</li><li>Calico</li><li>Canal</li><li>Weave</li></ul><h2 id="什么是-Calico"><a href="#什么是-Calico" class="headerlink" title="什么是 Calico"></a>什么是 Calico</h2><p>Calico 为容器和虚拟机提供了安全的网络连接解决方案，并经过了大规模生产验证（在公有云和跨数千个集群节点中），可与 Kubernetes，OpenShift，Docker，Mesos，DC / OS 和 OpenStack 集成。</p><p>Calico 还提供网络安全规则的动态实施。使用 Calico 的简单策略语言，您可以实现对容器，虚拟机工作负载和裸机主机端点之间通信的细粒度控制</p><h2 id="安装配置Calico"><a href="#安装配置Calico" class="headerlink" title="安装配置Calico"></a>安装配置Calico</h2><p>官网链接：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnByb2plY3RjYWxpY28ub3Jn" title="https://docs.projectcalico.org">点击访问<i class="fa fa-external-link"></i></span></p><ul><li>应用网络配置文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.11/manifests/calico.yaml</span><br></pre></td></tr></table></figure><ul><li>查看容器状态</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure><p>需要先下载镜像文件，略作等待所有的镜像文件下载完成，并运行状态为Running说明配置成功。</p><blockquote><p>Every 2.0s: kubectl get pods –all-namespaces                               k8smaster: Wed Mar 25 13:24:46 2020</p><p>NAMESPACE     NAME                                                            READY   STATUS    RESTARTS   AGE<br>kube-system   calico-kube-controllers-5b644bc49c-rlf9g   1/1     Running   0          81m<br>kube-system   calico-node-fvqlg                                              1/1     Running   0          8m30s<br>kube-system   calico-node-ltd5p                                              1/1     Running   0          81m<br>kube-system   calico-node-zwbg7                                            1/1     Running   0          81m<br>kube-system   coredns-9d85f5447-7p478                              1/1     Running   0          87m<br>kube-system   coredns-9d85f5447-dctn9                               1/1     Running   0          87m<br>kube-system   etcd-k8smaster                                                  1/1     Running   0          88m<br>kube-system   kube-apiserver-k8smaster                               1/1     Running   0          88m<br>kube-system   kube-controller-manager-k8smaster             1/1     Running   0          88m<br>kube-system   kube-proxy-bn8lx                                               1/1     Running   1          87m<br>kube-system   kube-proxy-jsw59                                               1/1     Running   1          82m<br>kube-system   kube-proxy-s5q54                                              1/1     Running   1          8m30s<br>kube-system   kube-scheduler-k8smaster                              1/1     Running   0          88m</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-07配置网络&quot;&gt;&lt;a href=&quot;#Kubernetes-07配置网络&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-07配置网络&quot;&gt;&lt;/a&gt;Kubernetes-07配置网络&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-06使用kubeadm配置slave节点</title>
    <link href="https://blog.jyusun.com/contents/20200101161126.html"/>
    <id>https://blog.jyusun.com/contents/20200101161126.html</id>
    <published>2020-01-01T08:11:26.000Z</published>
    <updated>2020-03-27T07:25:30.967Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-06使用kubeadm配置slave节点"><a href="#Kubernetes-06使用kubeadm配置slave节点" class="headerlink" title="Kubernetes-06使用kubeadm配置slave节点"></a>Kubernetes-06使用kubeadm配置slave节点</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p> 将 slave 节点加入到集群中很简单，只需要在 slave 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 <code>kubeadm join</code> 命令加入即可。准备工作如下： </p><h2 id="将node加入到集群"><a href="#将node加入到集群" class="headerlink" title="将node加入到集群"></a>将node加入到集群</h2><p>执行初始化master节点时候输出日志的<code>kubeadm join</code>命令，将node节点加入到集群中</p><ul><li><p>执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.233.200:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:8e523ebfd1ecd1fdb3578d254d94e60067e987ce3e9ad6c71af0245dea04d14b</span><br></pre></td></tr></table></figure></li></ul><p>说明：</p><ul><li>token<ul><li>可以通过安装 master 时的日志查看 token 信息</li><li>可以通过 <code>kubeadm token list</code> 命令打印出 token 信息</li><li>如果 token 过期，可以使用 <code>kubeadm token create</code> 命令创建新的 token</li></ul></li><li>discovery-token-ca-cert-hash<ul><li>可以通过安装 master 时的日志查看 sha256 信息</li><li>可以通过 <code>openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;</code> 命令查看 sha256 信息</li></ul></li></ul><h2 id="验证是否成功"><a href="#验证是否成功" class="headerlink" title="验证是否成功"></a>验证是否成功</h2><ul><li><p>回到master，输入命令验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure><blockquote><p>[root@k8smaster kubernetes]# kubectl get node<br>NAME            STATUS         ROLES       AGE       VERSION<br>k8smaster    NotReady      master    3h37m    v1.17.4<br>k8snode01   NotReady      node       3h34m    v1.17.4</p></blockquote></li><li><p>查看 pod 状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kube-system -o wide</span><br></pre></td></tr></table></figure><blockquote><p>NAME                                       READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES<br>coredns-9d85f5447-7p478                    0/1     Pending   0          6h23m   <none>    <none>   <none>           <none><br>coredns-9d85f5447-dctn9                    0/1     Pending   0          6h23m   <none>    <none>   <none>           <none><br>etcd-k8smaster                             1/1     Running   0          6h23m   192.168.233.200   k8smaster   <none>           <none><br>kube-apiserver-k8smaster                   1/1     Running   0          6h23m   192.168.233.200   k8smaster   <none>           <none><br>kube-controller-manager-k8smaster          1/1     Running   0          6h23m   192.168.233.200   k8smaster   <none>           <none><br>kube-proxy-bn8lx                           1/1     Running   1          6h23m   192.168.233.200   k8smaster   <none>           <none><br>kube-proxy-jsw59                           1/1     Running   1          6h18m   192.168.233.210   k8snode01   <none>           <none><br>kube-proxy-s5q54                           1/1     Running   1          5h3m    192.168.233.211   k8snode02   <none>           <none><br>kube-scheduler-k8smaster                   1/1     Running   0          6h23m   192.168.233.200   k8smaster   <none>           <none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></none></p></blockquote><p>由此可以看出 coredns 尚未运行，此时我们还需要安装网络插件。 </p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-06使用kubeadm配置slave节点&quot;&gt;&lt;a href=&quot;#Kubernetes-06使用kubeadm配置slave节点&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-06使用kubeadm配置slave节
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-05使用kubeadm初始化mstaer</title>
    <link href="https://blog.jyusun.com/contents/20200101151126.html"/>
    <id>https://blog.jyusun.com/contents/20200101151126.html</id>
    <published>2020-01-01T07:11:26.000Z</published>
    <updated>2020-03-27T07:25:20.513Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-05使用kubeadm初始化mstaer"><a href="#Kubernetes-05使用kubeadm初始化mstaer" class="headerlink" title="Kubernetes-05使用kubeadm初始化mstaer"></a>Kubernetes-05使用kubeadm初始化mstaer</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>速度发发</p><h2 id="初始化并配置"><a href="#初始化并配置" class="headerlink" title="初始化并配置"></a>初始化并配置</h2><h3 id="初始化主节点"><a href="#初始化主节点" class="headerlink" title="初始化主节点"></a>初始化主节点</h3><ul><li><p>初始化master</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --config=kubeadm-config.yml --upload-certs | tee kubeadm-init.log</span><br></pre></td></tr></table></figure><p>初始化过程日志输出</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&gt;[init] Using Kubernetes version: v1.17.4</span><br><span class="line">&gt;[preflight] Running pre-flight checks</span><br><span class="line">&gt;[preflight] Pulling images required for setting up a Kubernetes cluster</span><br><span class="line">&gt;[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">&gt;[preflight] You can also perform this action in beforehand using &apos;kubeadm config images pull&apos;</span><br><span class="line">&gt;[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class="line">&gt;[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class="line">&gt;[kubelet-start] Starting the kubelet</span><br><span class="line">&gt;[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;</span><br><span class="line">&gt;[certs] Generating &quot;ca&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;apiserver&quot; certificate and key</span><br><span class="line">&gt;[certs] apiserver serving cert is signed for DNS names [k8smaster kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.233.200]</span><br><span class="line">&gt;[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;front-proxy-ca&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;front-proxy-client&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;etcd/ca&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;etcd/server&quot; certificate and key</span><br><span class="line">&gt;[certs] etcd/server serving cert is signed for DNS names [k8smaster localhost] and IPs [192.168.233.200 127.0.0.1 ::1]</span><br><span class="line">&gt;[certs] Generating &quot;etcd/peer&quot; certificate and key</span><br><span class="line">&gt;[certs] etcd/peer serving cert is signed for DNS names [k8smaster localhost] and IPs [192.168.233.200 127.0.0.1 ::1]</span><br><span class="line">&gt;[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key</span><br><span class="line">&gt;[certs] Generating &quot;sa&quot; key and public key</span><br><span class="line">&gt;[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;</span><br><span class="line">&gt;[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file</span><br><span class="line">&gt;[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file</span><br><span class="line">&gt;[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file</span><br><span class="line">&gt;[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file</span><br><span class="line">&gt;[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">&gt;[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span><br><span class="line">&gt;[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span><br><span class="line">&gt;[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span><br><span class="line">&gt;[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">&gt;[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</span><br><span class="line">&gt;[apiclient] All control plane components are healthy after 18.507655 seconds</span><br><span class="line">&gt;[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class="line">&gt;[kubelet] Creating a ConfigMap &quot;kubelet-config-1.17&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line">&gt;[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace</span><br><span class="line">&gt;[upload-certs] Using certificate key:</span><br><span class="line">&gt;a4c99ea3701d5245d6ee81a04ed4d041340fd7d5cf837f1e53c8536151ae78f1</span><br><span class="line">&gt;[mark-control-plane] Marking the node k8smaster as control-plane by adding the label &quot;node-role.kubernetes.io/master=&apos;&apos;&quot;</span><br><span class="line">&gt;[mark-control-plane] Marking the node k8smaster as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">&gt;[bootstrap-token] Using token: abcdef.0123456789abcdef</span><br><span class="line">&gt;[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">&gt;[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">&gt;[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">&gt;[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">&gt;[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class="line">&gt;[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span><br><span class="line">&gt;[addons] Applied essential addon: CoreDNS</span><br><span class="line">&gt;[addons] Applied essential addon: kube-proxy</span><br><span class="line">&gt;</span><br><span class="line">&gt;Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">&gt;</span><br><span class="line">&gt;To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">&gt;</span><br><span class="line">&gt;  mkdir -p $HOME/.kube</span><br><span class="line">&gt;  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">&gt;  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line">&gt;</span><br><span class="line">&gt;You should now deploy a pod network to the cluster.</span><br><span class="line">&gt;Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">&gt;  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">&gt;</span><br><span class="line">&gt;Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line">&gt;</span><br><span class="line">&gt;kubeadm join 192.168.233.200:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">&gt;    --discovery-token-ca-cert-hash sha256:8e523ebfd1ecd1fdb3578d254d94e60067e987ce3e9ad6c71af0245dea04d14b</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><blockquote><p>注意：如果安装 kubernetes 版本和下载的镜像版本不统一则会出现 <code>timed out waiting for the condition</code> 错误。中途失败或是想修改配置可以使用 <code>kubeadm reset</code> 命令重置配置，再做初始化操作即可。 </p></blockquote></blockquote></li></ul><h3 id="配置-kubectl"><a href="#配置-kubectl" class="headerlink" title="配置 kubectl"></a>配置 kubectl</h3><p>依据上面日志输出的信息进行配置操作</p><ul><li><p>创建kube文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br></pre></td></tr></table></figure></li><li><p>复制配置文件到config路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></pre></td></tr></table></figure></li><li><p>授权，将配置文件授权给当前用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure></li></ul><h3 id="验证配置"><a href="#验证配置" class="headerlink" title="验证配置"></a>验证配置</h3><ul><li><p>查看节点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><blockquote><p>[root@k8smaster kubernetes]# kubectl get node<br>NAME          STATUS        ROLES       AGE     VERSION<br>k8smaster   NotReady      master   3h37m   v1.17.4</p></blockquote><p>至此主节点配置完成 </p></li></ul><h2 id="kubeadm-init-的执行过程"><a href="#kubeadm-init-的执行过程" class="headerlink" title="kubeadm init 的执行过程"></a>kubeadm init 的执行过程</h2><ul><li>init：指定版本进行初始化操作</li><li>preflight：初始化前的检查和下载所需要的 Docker 镜像文件</li><li>kubelet-start：生成 kubelet 的配置文件 <code>var/lib/kubelet/config.yaml</code>，没有这个文件 kubelet 无法启动，所以初始化之前的 kubelet 实际上启动不会成功</li><li>certificates：生成 Kubernetes 使用的证书，存放在 <code>/etc/kubernetes/pki</code> 目录中</li><li>kubeconfig：生成 KubeConfig 文件，存放在 <code>/etc/kubernetes</code> 目录中，组件之间通信需要使用对应文件</li><li>control-plane：使用 <code>/etc/kubernetes/manifest</code> 目录下的 YAML 文件，安装 Master 组件</li><li>etcd：使用 <code>/etc/kubernetes/manifest/etcd.yaml</code> 安装 Etcd 服务</li><li>wait-control-plane：等待 control-plan 部署的 Master 组件启动</li><li>apiclient：检查 Master 组件服务状态。</li><li>uploadconfig：更新配置</li><li>kubelet：使用 configMap 配置 kubelet</li><li>patchnode：更新 CNI 信息到 Node 上，通过注释的方式记录</li><li>mark-control-plane：为当前节点打标签，打了角色 Master，和不可调度标签，这样默认就不会使用 Master 节点来运行 Pod</li><li>bootstrap-token：生成 token 记录下来，后边使用 <code>kubeadm join</code> 往集群中添加节点时会用到</li><li>addons：安装附加组件 CoreDNS 和 kube-proxy</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-05使用kubeadm初始化mstaer&quot;&gt;&lt;a href=&quot;#Kubernetes-05使用kubeadm初始化mstaer&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-05使用kubeadm初始化mstae
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-04配置kubeadm</title>
    <link href="https://blog.jyusun.com/contents/20200101141126.html"/>
    <id>https://blog.jyusun.com/contents/20200101141126.html</id>
    <published>2020-01-01T06:11:26.000Z</published>
    <updated>2020-03-27T07:25:05.576Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-04配置kubeadm"><a href="#Kubernetes-04配置kubeadm" class="headerlink" title="Kubernetes-04配置kubeadm"></a>Kubernetes-04配置kubeadm</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p> 安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><ul><li><p>创建文件存储路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/docker/kubernetes &amp;&amp; cd /usr/local/docker/kubernetes</span><br></pre></td></tr></table></figure></li><li><p>获取默认配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config print init-defaults --kubeconfig ClusterConfiguration &gt; kubeadm-config.yml</span><br></pre></td></tr></table></figure></li><li><p>编辑获取到的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi kubeadm-config.yml</span><br></pre></td></tr></table></figure></li></ul><p>调整里面主要注释的几个地方</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&gt;apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">&gt;bootstrapTokens:</span><br><span class="line">&gt;- groups:</span><br><span class="line">&gt;  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">&gt;  token: abcdef.0123456789abcdef</span><br><span class="line">&gt;  ttl: 24h0m0s</span><br><span class="line">&gt;  usages:</span><br><span class="line">&gt;  - signing</span><br><span class="line">&gt;  - authentication</span><br><span class="line">&gt;kind: InitConfiguration</span><br><span class="line">&gt;localAPIEndpoint:</span><br><span class="line">&gt;  # 改成master节点的ip</span><br><span class="line">&gt;  advertiseAddress: 192.168.233.200</span><br><span class="line">&gt;  bindPort: 6443</span><br><span class="line">&gt;nodeRegistration:</span><br><span class="line">&gt;  criSocket: /var/run/dockershim.sock</span><br><span class="line">&gt;  name: k8smaster</span><br><span class="line">&gt;  taints:</span><br><span class="line">&gt;  - effect: NoSchedule</span><br><span class="line">&gt;    key: node-role.kubernetes.io/master</span><br><span class="line">&gt;---</span><br><span class="line">&gt;apiServer:</span><br><span class="line">&gt;  timeoutForControlPlane: 4m0s</span><br><span class="line">&gt;apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">&gt;certificatesDir: /etc/kubernetes/pki</span><br><span class="line">&gt;clusterName: kubernetes</span><br><span class="line">&gt;controllerManager: &#123;&#125;</span><br><span class="line">&gt;dns:</span><br><span class="line">&gt;  type: CoreDNS</span><br><span class="line">&gt;etcd:</span><br><span class="line">&gt;  local:</span><br><span class="line">&gt;    dataDir: /var/lib/etcd</span><br><span class="line">&gt;# 指定阿里云仓库地址</span><br><span class="line">&gt;imageRepository: registry.aliyuncs.com/google_containers</span><br><span class="line">&gt;kind: ClusterConfiguration</span><br><span class="line">&gt;# 修改为自己配置的版本</span><br><span class="line">&gt;kubernetesVersion: v1.17.4</span><br><span class="line">&gt;networking:</span><br><span class="line">&gt;  dnsDomain: cluster.local</span><br><span class="line">&gt;  # 配置成 Calico 的默认网段</span><br><span class="line">&gt;  podSubnet: 192.168.0.0/16</span><br><span class="line">&gt;  serviceSubnet: 10.96.0.0/12</span><br><span class="line">&gt;scheduler: &#123;&#125;</span><br><span class="line">&gt;---</span><br><span class="line">&gt;# 开启 IPVS 模式</span><br><span class="line">&gt;apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">&gt;kind: KubeProxyConfiguration</span><br><span class="line">&gt;featureGates:</span><br><span class="line">&gt;  SupportIPVSProxyMode: true</span><br><span class="line">&gt;mode: ipvs</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h2 id="查看和拉取镜像"><a href="#查看和拉取镜像" class="headerlink" title="查看和拉取镜像"></a>查看和拉取镜像</h2><ul><li><p>查看镜像文件版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list --config kubeadm-config.yml</span><br></pre></td></tr></table></figure></li><li><p>拉取配置中所需的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --config kubeadm-config.yml</span><br></pre></td></tr></table></figure></li></ul>  ]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-04配置kubeadm&quot;&gt;&lt;a href=&quot;#Kubernetes-04配置kubeadm&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-04配置kubeadm&quot;&gt;&lt;/a&gt;Kubernetes-04配置kubea
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-03安装kubeadm</title>
    <link href="https://blog.jyusun.com/contents/20200101131126.html"/>
    <id>https://blog.jyusun.com/contents/20200101131126.html</id>
    <published>2020-01-01T05:11:26.000Z</published>
    <updated>2020-03-27T07:24:48.430Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-03安装-kubeadm"><a href="#Kubernetes-03安装-kubeadm" class="headerlink" title="Kubernetes-03安装 kubeadm"></a>Kubernetes-03安装 kubeadm</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p> kubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群。 </p><h2 id="配置kubernetes软件源"><a href="#配置kubernetes软件源" class="headerlink" title="配置kubernetes软件源"></a>配置kubernetes软件源</h2><ul><li>kubernetes阿里云源</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1=</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg&quot; &gt;&gt;/etc/yum.repos.d/kubernetes.repo</span><br></pre></td></tr></table></figure><h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><h3 id="安装kubernetes所需工具"><a href="#安装kubernetes所需工具" class="headerlink" title="安装kubernetes所需工具"></a>安装kubernetes所需工具</h3><ul><li><p>kubelet、kubeadm、kubectl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure></li></ul><h3 id="启动kubelet"><a href="#启动kubelet" class="headerlink" title="启动kubelet"></a>启动kubelet</h3><ul><li><p>安装完成后启动 kubelet服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now kubelet</span><br></pre></td></tr></table></figure></li></ul><h2 id="集群配置文件"><a href="#集群配置文件" class="headerlink" title="集群配置文件"></a>集群配置文件</h2><ul><li><p>创建文件存储路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/docker/kubernetes &amp;&amp; cd /usr/local/docker/kubernetes</span><br></pre></td></tr></table></figure></li><li><p>获取默认配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config print init-defaults --kubeconfig ClusterConfiguration &gt; kubeadm-config.yml</span><br></pre></td></tr></table></figure></li><li><p>编辑获取到的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi kubeadm-config.yml</span><br></pre></td></tr></table></figure></li></ul><p>调整里面主要注释的几个地方</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&gt;apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">&gt;bootstrapTokens:</span><br><span class="line">&gt;- groups:</span><br><span class="line">&gt;  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">&gt;  token: abcdef.0123456789abcdef</span><br><span class="line">&gt;  ttl: 24h0m0s</span><br><span class="line">&gt;  usages:</span><br><span class="line">&gt;  - signing</span><br><span class="line">&gt;  - authentication</span><br><span class="line">&gt;kind: InitConfiguration</span><br><span class="line">&gt;localAPIEndpoint:</span><br><span class="line">&gt;  # 改成master节点的ip</span><br><span class="line">&gt;  advertiseAddress: 192.168.233.200</span><br><span class="line">&gt;  bindPort: 6443</span><br><span class="line">&gt;nodeRegistration:</span><br><span class="line">&gt;  criSocket: /var/run/dockershim.sock</span><br><span class="line">&gt;  name: k8smaster</span><br><span class="line">&gt;  taints:</span><br><span class="line">&gt;  - effect: NoSchedule</span><br><span class="line">&gt;    key: node-role.kubernetes.io/master</span><br><span class="line">&gt;---</span><br><span class="line">&gt;apiServer:</span><br><span class="line">&gt;  timeoutForControlPlane: 4m0s</span><br><span class="line">&gt;apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">&gt;certificatesDir: /etc/kubernetes/pki</span><br><span class="line">&gt;clusterName: kubernetes</span><br><span class="line">&gt;controllerManager: &#123;&#125;</span><br><span class="line">&gt;dns:</span><br><span class="line">&gt;  type: CoreDNS</span><br><span class="line">&gt;etcd:</span><br><span class="line">&gt;  local:</span><br><span class="line">&gt;    dataDir: /var/lib/etcd</span><br><span class="line">&gt;# 指定阿里云仓库地址</span><br><span class="line">&gt;imageRepository: registry.aliyuncs.com/google_containers</span><br><span class="line">&gt;kind: ClusterConfiguration</span><br><span class="line">&gt;# 修改为自己配置的版本</span><br><span class="line">&gt;kubernetesVersion: v1.17.4</span><br><span class="line">&gt;networking:</span><br><span class="line">&gt;  dnsDomain: cluster.local</span><br><span class="line">&gt;  # 配置成 Calico 的默认网段</span><br><span class="line">&gt;  podSubnet: 192.168.0.0/16</span><br><span class="line">&gt;  serviceSubnet: 10.96.0.0/12</span><br><span class="line">&gt;scheduler: &#123;&#125;</span><br><span class="line">&gt;---</span><br><span class="line">&gt;# 开启 IPVS 模式</span><br><span class="line">&gt;apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">&gt;kind: KubeProxyConfiguration</span><br><span class="line">&gt;featureGates:</span><br><span class="line">&gt;  SupportIPVSProxyMode: true</span><br><span class="line">&gt;mode: ipvs</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h2 id="查看和拉取镜像"><a href="#查看和拉取镜像" class="headerlink" title="查看和拉取镜像"></a>查看和拉取镜像</h2><ul><li><p>查看镜像文件版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list --config kubeadm-config.yml</span><br></pre></td></tr></table></figure></li><li><p>拉取配置中所需的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --config kubeadm-config.yml</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-03安装-kubeadm&quot;&gt;&lt;a href=&quot;#Kubernetes-03安装-kubeadm&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-03安装 kubeadm&quot;&gt;&lt;/a&gt;Kubernetes-03安装 k
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-集群安装准备</title>
    <link href="https://blog.jyusun.com/contents/20200101121126.html"/>
    <id>https://blog.jyusun.com/contents/20200101121126.html</id>
    <published>2020-01-01T04:11:26.000Z</published>
    <updated>2020-03-27T08:07:10.677Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-集群安装准备"><a href="#Kubernetes-集群安装准备" class="headerlink" title="Kubernetes-集群安装准备"></a>Kubernetes-集群安装准备</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本次安装采用    CentOS 8 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：</p><ul><li>OS：CentOS Linux release 8.1.1911</li><li>CPU：最低要求，2 CPU 2 核</li><li>内存：最低要求，2GB</li><li>磁盘：最低要求，20GB</li></ul><h2 id="节点准备（3个节点）"><a href="#节点准备（3个节点）" class="headerlink" title="节点准备（3个节点）"></a>节点准备（3个节点）</h2><ul><li>具体配置详情</li></ul><table><thead><tr><th>主机名称</th><th>IP</th><th>角色</th><th>CPU/内存</th><th>磁盘</th></tr></thead><tbody><tr><td>k8smaster</td><td>192.168.233.200</td><td>master</td><td>2核/2G</td><td>20G</td></tr><tr><td>k8snode01</td><td>192.168.233.210</td><td>node</td><td>2核/4G</td><td>20G</td></tr><tr><td>k8snode02</td><td>192.168.233.211</td><td>node</td><td>2核/4G</td><td>20G</td></tr></tbody></table><h2 id="系统基础配置"><a href="#系统基础配置" class="headerlink" title="系统基础配置"></a>系统基础配置</h2><p><strong>3个节点都需要配置的操作</strong></p><h3 id="配置固定IP地址"><a href="#配置固定IP地址" class="headerlink" title="配置固定IP地址"></a>配置固定IP地址</h3><p>分别为每个节点配置固定IP地址：<a href>点击了解</a></p><h3 id="配置Hosts"><a href="#配置Hosts" class="headerlink" title="配置Hosts"></a>配置Hosts</h3><p>分别在每个节点的/etc/hosts   追加配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;192.168.233.200 k8smaster</span><br><span class="line">192.168.233.210 k8snode01</span><br><span class="line">192.168.233.211 k8snode02&quot; &gt;&gt;/etc/hosts</span><br></pre></td></tr></table></figure><blockquote><p>192.168.233.200 k8smaster<br>192.168.233.210 k8snode01<br>192.168.233.211 k8snode02</p></blockquote><h3 id="配置HostName"><a href="#配置HostName" class="headerlink" title="配置HostName"></a>配置HostName</h3><p>根据节点规划分别配置对应的/etc/hostname</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname &lt;HOSTNAME&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如：</span><br><span class="line">hostnamectl set-hostname k8smaster</span><br><span class="line">hostnamectl set-hostname k8snode01</span><br><span class="line">hostnamectl set-hostname k8snode02</span><br></pre></td></tr></table></figure><p>查看hostname配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl</span><br></pre></td></tr></table></figure><blockquote><p>  Static hostname: <strong>k8smaster</strong><br>        Icon name: computer-vm<br>          Chassis: vm<br>       Machine ID: ef8884ea25f948beb7f8278d18789f2e<br>          Boot ID: cc67657a70f14ddcbbcfe724df79981c<br>   Virtualization: oracle<br> Operating System: CentOS Linux 8 (Core)<br>      CPE OS Name: cpe:/o:centos:centos:8<br>           Kernel: Linux 4.18.0-147.el8.x86_64<br>     Architecture: x86-64</p></blockquote><h3 id="关闭交换空间"><a href="#关闭交换空间" class="headerlink" title="关闭交换空间"></a>关闭交换空间</h3><p>交换空间对虚拟化资源损耗较大，成本损耗较高，一般虚拟化技术是不允许开启交换空间的，如果不关闭交换空间，k8s初始时也会有相应的提示信息。</p><ul><li><p>关闭交换空间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -a</span><br></pre></td></tr></table></figure></li><li><p>避免开机启动交换空间：注释 /etc/fstab 中的 swap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/fstab</span><br></pre></td></tr></table></figure><blockquote><p>#注释掉这一行并保存</p><p>#/dev/mapper/cl-swap     swap                    swap    defaults        0 0</p></blockquote></li><li><p>查看交换空间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure><blockquote><pre><code>total     used      free     shared    buff/cache   available</code></pre><p>Mem:             1.8Gi             896Mi         101Mi          9.0Mi         831Mi                862Mi<br>Swap:             0B                 0B                0B</p></blockquote></li></ul><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>防火墙操作：<a href>点击了解</a></p><h3 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h3><p>临时关闭</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><p>永久关闭，避免开启启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><p>k8s集群保证每个节点时间是同步的，需要同步节点时间</p><p>时间同步操作：<a href>点击了解</a></p><h3 id="写入k8s-conf"><a href="#写入k8s-conf" class="headerlink" title="写入k8s.conf"></a>写入k8s.conf</h3><ul><li>一些 RHEL/CentOS 7 的用户曾经遇到过问题：由于 iptables 被绕过而导致流量无法正确路由的问题。您应该确保 在 <code>sysctl</code> 配置中的 </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/k8s.conf&lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><ul><li>执行命令使修改生效</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysctl -f /etc/sysctl.d/k8s.conf</span><br><span class="line">或</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><h2 id="Docker相关"><a href="#Docker相关" class="headerlink" title="Docker相关"></a>Docker相关</h2><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><p>docker安装操作：<a href>点击了解</a></p><h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h3><p>docker-compose安装操作：<a href>点击了解</a>)</p><h3 id="修改daemon-json"><a href="#修改daemon-json" class="headerlink" title="修改daemon.json"></a>修改daemon.json</h3><p>配置docker阿里云加速，以及修改docker的cgroupdriver驱动</p><ul><li><p>修改或创建/etc/docker/daemon.json，加入下面的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://l46iaapq.mirror.aliyuncs.com&quot;],</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="line">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">  &quot;log-opts&quot;: &#123;</span><br><span class="line">    &quot;max-size&quot;: &quot;100m&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-集群安装准备&quot;&gt;&lt;a href=&quot;#Kubernetes-集群安装准备&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-集群安装准备&quot;&gt;&lt;/a&gt;Kubernetes-集群安装准备&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-01简介</title>
    <link href="https://blog.jyusun.com/contents/20200101111126.html"/>
    <id>https://blog.jyusun.com/contents/20200101111126.html</id>
    <published>2020-01-01T03:11:26.000Z</published>
    <updated>2020-03-27T07:24:14.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-01简介"><a href="#Kubernetes-01简介" class="headerlink" title="Kubernetes-01简介"></a>Kubernetes-01简介</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>​    </p><p>Kubernetes 是 <strong>Google 2014 年创建管理的</strong>，是 Google 10 多年大规模容器管理技术 Borg 的开源版本。</p><p>Kubernetes 是容器集群管理系统，是一个开源的平台，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。使用 Kubernetes 我们可以：</p><ul><li>快速部署应用</li><li>快速扩展应用</li><li>无缝对接新的应用功能</li><li>节省资源，优化硬件资源的使用</li></ul><p>Kubernetes 的目标是促进完善组件和工具的生态系统，以减轻应用程序在公有云或私有云中运行的负担。</p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li><strong>可移植：</strong> 支持公有云，私有云，混合云，多重云（多个公共云）</li><li><strong>可扩展：</strong> 模块化，插件化，可挂载，可组合</li><li><strong>自动化：</strong> 自动部署，自动重启，自动复制，自动伸缩/扩展</li></ul><h2 id="从传统到容器化部署"><a href="#从传统到容器化部署" class="headerlink" title="从传统到容器化部署"></a>从传统到容器化部署</h2><h3 id="传统的部署方式"><a href="#传统的部署方式" class="headerlink" title="传统的部署方式"></a>传统的部署方式</h3><ul><li>传统的应用部署方式是通过插件或脚本来安装应用。这样做的缺点是应用的运行、配置、管理、所有生存周期将与当前操作系统绑定，这样做并不利于应用的升级更新/回滚等操作，当然也可以通过创建虚机的方式来实现某些功能，但是虚拟机非常重，并不利于可移植性。</li></ul><h3 id="容器化部署的优势"><a href="#容器化部署的优势" class="headerlink" title="容器化部署的优势"></a>容器化部署的优势</h3><ul><li><strong>快速创建/部署应用：</strong> 与虚拟机相比，容器镜像的创建更加容易。</li><li><strong>持续开发、集成和部署：</strong> 提供可靠且频繁的容器镜像构建/部署，并使用快速和简单的回滚(由于镜像不可变性)。</li><li><strong>开发和运行相分离：</strong> 在 build 或者 release 阶段创建容器镜像，使得应用和基础设施解耦。</li><li><strong>开发，测试和生产环境一致性：</strong> 在本地或外网（生产环境）运行的一致性。</li><li><strong>云平台或其他操作系统：</strong> 可以在 Ubuntu、RHEL、CoreOS、on-prem、Google Container Engine 或其它任何环境中运行。</li><li><strong>分布式，弹性，微服务化：</strong> 应用程序分为更小的、独立的部件，可以动态部署和管理。</li><li><strong>资源隔离</strong></li><li><strong>资源利用更高效</strong></li></ul><h2 id="为什么需要-Kubernetes"><a href="#为什么需要-Kubernetes" class="headerlink" title="为什么需要 Kubernetes"></a>为什么需要 Kubernetes</h2><p>可以在物理或虚拟机的 Kubernetes 集群上运行容器化应用，Kubernetes 能提供一个以 <strong>“容器为中心的基础架构”</strong>，满足在生产环境中运行应用的一些常见需求，如：</p><ul><li>多个进程协同工作</li><li>存储系统挂载</li><li>应用健康检查</li><li>应用实例的复制</li><li>自动伸缩/扩展</li><li>注册与发现</li><li>负载均衡</li><li>滚动更新</li><li>资源监控</li><li>日志访问</li><li>调试应用程序</li><li>提供认证和授权</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Kubernetes-01简介&quot;&gt;&lt;a href=&quot;#Kubernetes-01简介&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-01简介&quot;&gt;&lt;/a&gt;Kubernetes-01简介&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="Kubernetes" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/Kubernetes/"/>
    
    
      <category term="k8s" scheme="https://blog.jyusun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Linux关闭交换空间</title>
    <link href="https://blog.jyusun.com/contents/20191127183005.html"/>
    <id>https://blog.jyusun.com/contents/20191127183005.html</id>
    <published>2019-11-27T10:30:05.000Z</published>
    <updated>2020-03-23T03:16:55.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux关闭交换空间"><a href="#Linux关闭交换空间" class="headerlink" title="Linux关闭交换空间"></a>Linux关闭交换空间</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>交换空间是现代 Linux 系统中的第二种内存类型。交换空间的主要功能是当全部的 RAM 被占用并且需要更多内存时，用磁盘空间代替 RAM 内存。交换空间对虚拟化技术资源损耗较大，成本损耗较高，一般虚拟化技术是不允许开启交换空间的，如果不关闭交换空间，虚拟化相关程序会报错或相应的提示信息（如Kubernates）。</p><h2 id="关闭交换空间"><a href="#关闭交换空间" class="headerlink" title="关闭交换空间"></a>关闭交换空间</h2><ul><li><p>关闭交换空间（临时）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -a</span><br></pre></td></tr></table></figure></li><li><p>避免开机启动交换空间：注释 /etc/fstab 中的 swap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/fstab</span><br></pre></td></tr></table></figure><blockquote><p>#注释掉swap这一行并保存</p><p>#/dev/mapper/cl-swap     swap                    swap    defaults        0 0</p></blockquote></li><li><p>查看交换空间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure><blockquote><pre><code>total     used      free     shared    buff/cache   available</code></pre><p>Mem:             1.8Gi             896Mi         101Mi          9.0Mi         831Mi                862Mi<br>Swap:             0B                 0B                0B</p></blockquote></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Linux关闭交换空间&quot;&gt;&lt;a href=&quot;#Linux关闭交换空间&quot; class=&quot;headerlink&quot; title=&quot;Linux关闭交换空间&quot;&gt;&lt;/a&gt;Linux关闭交换空间&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;head
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="系统配置" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="关闭交换空间" scheme="https://blog.jyusun.com/tags/%E5%85%B3%E9%97%AD%E4%BA%A4%E6%8D%A2%E7%A9%BA%E9%97%B4/"/>
    
  </entry>
  
  <entry>
    <title>CentOS8时间同步</title>
    <link href="https://blog.jyusun.com/contents/20191127181126.html"/>
    <id>https://blog.jyusun.com/contents/20191127181126.html</id>
    <published>2019-11-27T10:11:26.000Z</published>
    <updated>2020-03-23T03:09:51.669Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS8时间同步"><a href="#CentOS8时间同步" class="headerlink" title="CentOS8时间同步"></a>CentOS8时间同步</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>最近在CentOs8操作时间同步，却发现在CentOS8中默认已经不再支持ntpd软件包，同时也无法通过官方软件仓库安装， CentOS8上使用Chrony配置NTP服务器，用于同步时间。 它有两个程序，chrony和chronyd， chronyd是守护进程 ，chrony是一个命令行界面程序，可以用来监控chronyd的性能，并修改各种操作参数。 </p><h2 id="安装chrony"><a href="#安装chrony" class="headerlink" title="安装chrony"></a>安装chrony</h2><p>系统会默认安装并启动，如果系统不存在则需要安装此工具库。</p><ul><li>仓库中直接安装</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install chrony</span><br></pre></td></tr></table></figure><ul><li>启动守护进程</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable –now chronyd</span><br></pre></td></tr></table></figure><h2 id="时间同步配置"><a href="#时间同步配置" class="headerlink" title="时间同步配置"></a>时间同步配置</h2><h3 id="设置时区"><a href="#设置时区" class="headerlink" title="设置时区"></a>设置时区</h3><ul><li>联网的情况下一般设置时区后会通过网络同步时间</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone &quot;Asia/Shanghai&quot;</span><br></pre></td></tr></table></figure><h3 id="配置chrony-conf"><a href="#配置chrony-conf" class="headerlink" title="配置chrony.conf"></a>配置chrony.conf</h3><ul><li><p>修改配置加入aliyun pool网络时间，也可以加入多个pool服务器 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/chrony.conf</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&gt;# Use public servers from the pool.ntp.org project.</span><br><span class="line">&gt;# Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">&gt;pool 2.centos.pool.ntp.org iburst</span><br><span class="line">&gt;pool ntp.aliyun.com iburst</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Record the rate at which the system clock gains/losses time.</span><br><span class="line">&gt;driftfile /var/lib/chrony/drift</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Allow the system clock to be stepped in the first three updates</span><br><span class="line">&gt;# if its offset is larger than 1 second.</span><br><span class="line">&gt;makestep 1.0 3</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Enable kernel synchronization of the real-time clock (RTC).</span><br><span class="line">&gt;rtcsync</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Enable hardware timestamping on all interfaces that support it.</span><br><span class="line">&gt;#hwtimestamp *</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Increase the minimum number of selectable sources required to adjust</span><br><span class="line">&gt;# the system clock.</span><br><span class="line">&gt;#minsources 2</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Allow NTP client access from local network.</span><br><span class="line">&gt;#allow 192.168.0.0/16</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Serve time even if not synchronized to a time source.</span><br><span class="line">&gt;#local stratum 10</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Specify file containing keys for NTP authentication.</span><br><span class="line">&gt;keyfile /etc/chrony.keys</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Get TAI-UTC offset and leap seconds from the system tz database.</span><br><span class="line">&gt;leapsectz right/UTC</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Specify directory for log files.</span><br><span class="line">&gt;logdir /var/log/chrony</span><br><span class="line">&gt;</span><br><span class="line">&gt;# Select which information is logged.</span><br><span class="line">&gt;#log measurements statistics tracking</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>重新加载配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart chronyd.service</span><br></pre></td></tr></table></figure></li></ul><h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><ul><li><p>执行时间同步命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources -v</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;[root@k8smaster ~]# chronyc sources -v</span><br><span class="line">&gt;210 Number of sources = 5</span><br><span class="line">&gt;</span><br><span class="line">&gt;  .-- Source mode  &apos;^&apos; = server, &apos;=&apos; = peer, &apos;#&apos; = local clock.</span><br><span class="line">&gt; / .- Source state &apos;*&apos; = current synced, &apos;+&apos; = combined , &apos;-&apos; = not combined,</span><br><span class="line">&gt;| /   &apos;?&apos; = unreachable, &apos;x&apos; = time may be in error, &apos;~&apos; = time too variable.</span><br><span class="line">&gt;||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">&gt;||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">&gt;||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">&gt;||                                \     |          |  zzzz = estimated error.</span><br><span class="line">&gt;||                                 |    |           \</span><br><span class="line">&gt;MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">&gt;===============================================================================</span><br><span class="line">&gt;^- ntp5.flashdance.cx            2   6   377     6  +8255us[+8255us] +/-  139ms</span><br><span class="line">&gt;^- 185.216.231.25                2   7    13     6    +10ms[  +10ms] +/-   98ms</span><br><span class="line">&gt;^- 119.28.206.193                2   6   377     9  +1016us[+1001us] +/-   62ms</span><br><span class="line">&gt;^* dns1.synet.edu.cn             2   6   377     8  -1423us[-1438us] +/- 9294us</span><br><span class="line">&gt;^+ 203.107.6.88                  2   6   377     7  +2107us[+2107us] +/-   17ms</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li></ul><h3 id="查看时间"><a href="#查看时间" class="headerlink" title="查看时间"></a>查看时间</h3><ul><li><p>查看当前系统时间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CentOS8时间同步&quot;&gt;&lt;a href=&quot;#CentOS8时间同步&quot; class=&quot;headerlink&quot; title=&quot;CentOS8时间同步&quot;&gt;&lt;/a&gt;CentOS8时间同步&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;head
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="系统配置" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="时间同步" scheme="https://blog.jyusun.com/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>idea-Java导入设置</title>
    <link href="https://blog.jyusun.com/contents/20190615141126.html"/>
    <id>https://blog.jyusun.com/contents/20190615141126.html</id>
    <published>2019-06-15T06:11:26.000Z</published>
    <updated>2020-02-12T09:41:06.828Z</updated>
    
    <content type="html"><![CDATA[<h1 id="导入设置"><a href="#导入设置" class="headerlink" title="导入设置"></a>导入设置</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>编码时候，需要明确的导入类以便于出现问题时我们查看引用的类是否正确，所以尽量避免引用*这种方式全量导入。</li><li>即时导入和导入优化，解决了我们编码过程中知道类名还需要再次引用选择的问题，以及不调整代码后有些无效的导入自动清理。</li></ul><h2 id="导入变-问题"><a href="#导入变-问题" class="headerlink" title="导入变*问题"></a>导入变*问题</h2><ul><li><p>当导入的同一包下的类超过默认指定的数量时会自动变成*</p></li><li><p>设置方法：<code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>Code Style</code>-&gt;<code>Java</code>-&gt;<code>imports</code></p><img src="/contents/20190615141126/imports.jpg" title="ideaversion"></li></ul><h2 id="即时导入和优化导入"><a href="#即时导入和优化导入" class="headerlink" title="即时导入和优化导入"></a>即时导入和优化导入</h2><ul><li>编写代码的过程中所使用的明确的类会自动导入进来，无用的类会被及时清理掉</li><li>设置方法：<code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>General</code>-&gt;<code>Auto Import</code></li></ul><p>​    <img src="/contents/20190615141126/import_package.jpg" title="ideaversion"></p><blockquote><p>导入明确的类</p><p>即时优化当前导入</p></blockquote><p>注：如不明确的类需要自己Alt+Enter自行导入，也可以使用Ctrl+Shift+Alt+L快捷键优化导入</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;导入设置&quot;&gt;&lt;a href=&quot;#导入设置&quot; class=&quot;headerlink&quot; title=&quot;导入设置&quot;&gt;&lt;/a&gt;导入设置&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="工具配置" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="idea" scheme="https://blog.jyusun.com/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>idea-设置代码超出限定长度自动换行</title>
    <link href="https://blog.jyusun.com/contents/20190605160148.html"/>
    <id>https://blog.jyusun.com/contents/20190605160148.html</id>
    <published>2019-06-05T08:01:48.000Z</published>
    <updated>2020-02-12T09:40:16.909Z</updated>
    
    <content type="html"><![CDATA[<h1 id="代码超出限定长度自动换行"><a href="#代码超出限定长度自动换行" class="headerlink" title="代码超出限定长度自动换行"></a>代码超出限定长度自动换行</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li><p>依据阿里巴巴开发规范 限定每行代码长度120</p></li><li><p>Windows下idea版本展示</p><img src="/contents/20190605160148/idea-version.jpg" title="ideaversion"></li></ul><h2 id="限定长度自动换行"><a href="#限定长度自动换行" class="headerlink" title="限定长度自动换行"></a>限定长度自动换行</h2><ul><li><p>默认每行展示长度为120，限制为120</p></li><li><p>设置方法：<code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>Code Style</code></p><blockquote><p>选中<code>Wrap on typing</code>，输入超过限定长度时，自动换行。</p></blockquote><img src="/contents/20190605160148/set-length.jpg" title="ideaversion"></li></ul><h2 id="代码格式化时换行"><a href="#代码格式化时换行" class="headerlink" title="代码格式化时换行"></a>代码格式化时换行</h2><ul><li><p>设置方法：<code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>Code Style</code>-&gt;<code>Java</code>-&gt;<code>Wrapping and Braces</code></p><blockquote><p>选中<code>Ensure right marigin is not exceed</code>，当执行代码格式化时，会自动根据限定长度换行</p></blockquote><img src="/contents/20190605160148/format.jpg" title="ideaversion"></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;代码超出限定长度自动换行&quot;&gt;&lt;a href=&quot;#代码超出限定长度自动换行&quot; class=&quot;headerlink&quot; title=&quot;代码超出限定长度自动换行&quot;&gt;&lt;/a&gt;代码超出限定长度自动换行&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="开发工具" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="idea" scheme="https://blog.jyusun.com/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>VirtualBox-Install-Android-x86_64</title>
    <link href="https://blog.jyusun.com/contents/20190423125339.html"/>
    <id>https://blog.jyusun.com/contents/20190423125339.html</id>
    <published>2019-04-23T04:53:39.000Z</published>
    <updated>2019-04-24T02:57:39.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VirtualBox-Install-Android-x86-64"><a href="#VirtualBox-Install-Android-x86-64" class="headerlink" title="VirtualBox-Install-Android-x86_64"></a>VirtualBox-Install-Android-x86_64</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>先上图片，具体说明稍后维护</li><li>VirtualBox版本：6.0.6</li><li>Android-x86_64版本：8.1-r1</li></ul><h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><img src="/contents/20190423125339/newvm1.jpg" title="点击新建"><img src="/contents/20190423125339/newvm2version.jpg" title="指定其他版本"><img src="/contents/20190423125339/newvm3ram.jpg" title="调整虚拟机内存"><img src="/contents/20190423125339/newvm4newfile.jpg" title="新创建一个虚拟磁盘"><img src="/contents/20190423125339/newvm5filetype.jpg" title="指定虚拟磁盘类型"><img src="/contents/20190423125339/newvm6.jpg" title="动态分配"><img src="/contents/20190423125339/newvm7disk.jpg" title="指定磁盘大小"><img src="/contents/20190423125339/newvm8cpu.jpg" title="分配cpu"><img src="/contents/20190423125339/newvm9show.jpg" title="显存"><img src="/contents/20190423125339/newvm10.jpg" title="显添加安卓iso镜像"><img src="/contents/20190423125339/newvm11.jpg" title="注册iso镜像"><img src="/contents/20190423125339/newvm12.jpg" title="完成"><img src="/contents/20190423125339/newvm13.jpg" title="网络"><h2 id="系统安装图解"><a href="#系统安装图解" class="headerlink" title="系统安装图解"></a>系统安装图解</h2><ul><li>虚拟机配置完成后，启动安装</li></ul><img src="/contents/20190423125339/install1.jpg" title="启动安装"><img src="/contents/20190423125339/install2.jpg" title="启动安装"><img src="/contents/20190423125339/install3gpt.jpg" title="启动安装"><img src="/contents/20190423125339/install4newdisk.jpg" title="启动安装"><img src="/contents/20190423125339/install5enter.jpg" title="启动安装"><img src="/contents/20190423125339/install6bootable.jpg" title="启动安装"><img src="/contents/20190423125339/install7write.jpg" title="启动安装"><img src="/contents/20190423125339/install8quit.jpg" title="启动安装"><img src="/contents/20190423125339/install9ok.jpg" title="启动安装"><img src="/contents/20190423125339/install10ext4.jpg" title="启动安装"><img src="/contents/20190423125339/install11formatext4.jpg" title="启动安装"><img src="/contents/20190423125339/install12GRUB.jpg" title="启动安装"><img src="/contents/20190423125339/install13.jpg" title="启动安装"><img src="/contents/20190423125339/install14.rebootjpg.jpg" title="重启"><img src="/contents/20190423125339/install15rm.jpg" title="删除iso"><img src="/contents/20190423125339/install16sys.jpg" title="安装完成">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;VirtualBox-Install-Android-x86-64&quot;&gt;&lt;a href=&quot;#VirtualBox-Install-Android-x86-64&quot; class=&quot;headerlink&quot; title=&quot;VirtualBox-Install-Android
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>基于Windows10安装配置及卸载MySQL8社区版</title>
    <link href="https://blog.jyusun.com/contents/20190328112159.html"/>
    <id>https://blog.jyusun.com/contents/20190328112159.html</id>
    <published>2019-03-28T03:21:59.000Z</published>
    <updated>2020-02-12T09:42:48.506Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装配置及卸载MySQL8社区版"><a href="#安装配置及卸载MySQL8社区版" class="headerlink" title="安装配置及卸载MySQL8社区版"></a>安装配置及卸载MySQL8社区版</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>今天写一个工具，需要使用到数据库，于是在电脑上安装了一个MySQL8社区版数据库，对整个安装过程进行了如下整理。</li></ul><h2 id="下载MySQL并解压缩"><a href="#下载MySQL并解压缩" class="headerlink" title="下载MySQL并解压缩"></a>下载MySQL并解压缩</h2><h3 id="下载社区版"><a href="#下载社区版" class="headerlink" title="下载社区版"></a>下载社区版</h3><ul><li>点击进入<span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2Rvd25sb2Fkcy9teXNxbC8=" title="https://dev.mysql.com/downloads/mysql/">MySQL最新社区版下载<i class="fa fa-external-link"></i></span>页面</li></ul><h3 id="解压缩文件"><a href="#解压缩文件" class="headerlink" title="解压缩文件"></a>解压缩文件</h3><ul><li><p>使用解压缩工具对压缩包进行解压</p><img src="/contents/20190328112159/unzip.jpg" title="解压缩"></li><li><p>压缩包内文件展示</p><img src="/contents/20190328112159/showfiles.jpg" title="初始压缩包文件内容"></li></ul><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><ul><li><p>MYSQL_HOME配置</p><blockquote><p>MYSQL_HOME=安装地址</p></blockquote><img src="/contents/20190328112159/mysqlhome.jpg" title="MYSQL_HOME"></li><li><p>path中配置bin目录</p><img src="/contents/20190328112159/path.jpg" title="path环境变量配置"></li></ul><h3 id="MySQL配置文件"><a href="#MySQL配置文件" class="headerlink" title="MySQL配置文件"></a>MySQL配置文件</h3><ul><li>根目录下新建<code>my-default.ini</code>或<code>my.ini</code>文件并添加以下内容</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Other default tuning values</span></span><br><span class="line"><span class="comment"># MySQL Server Instance Configuration File</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Generated by the MySQL Server Instance Configuration Wizard</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Installation Instructions</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># On Linux you can copy this file to /etc/my.cnf to set global options,</span></span><br><span class="line"><span class="comment"># mysql-data-dir/my.cnf to set server-specific options</span></span><br><span class="line"><span class="comment"># (@localstatedir@ for this installation) or to</span></span><br><span class="line"><span class="comment"># ~/.my.cnf to set user-specific options.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># On Windows you should keep this file in the installation directory </span></span><br><span class="line"><span class="comment"># of your server (e.g. C:\Program Files\MySQL\MySQL Server X.Y). To</span></span><br><span class="line"><span class="comment"># make sure the server reads the config file use the startup option </span></span><br><span class="line"><span class="comment"># "--defaults-file". </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To run run the server from the command line, execute this in a </span></span><br><span class="line"><span class="comment"># command line shell, e.g.</span></span><br><span class="line"><span class="comment"># mysqld --defaults-file="G:\Mysql\mysql-5.6.10-winx64\my.ini"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To install the server as a Windows service manually, execute this in a </span></span><br><span class="line"><span class="comment"># command line shell, e.g.</span></span><br><span class="line"><span class="comment"># mysqld --install MySQLXY --defaults-file="G:\Mysql\mysql-5.6.10-winx64\my.ini"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># And then execute this in a command line shell to start the server, e.g.</span></span><br><span class="line"><span class="comment"># net start MySQLXY</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Guildlines for editing this file</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In this file, you can use all long options that the program supports.</span></span><br><span class="line"><span class="comment"># If you want to know the options a program supports, start the program</span></span><br><span class="line"><span class="comment"># with the "--help" option.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># More detailed information about the individual options can also be</span></span><br><span class="line"><span class="comment"># found in the manual.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For advice on how to change settings please see</span></span><br><span class="line"><span class="comment"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># CLIENT SECTION</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following options will be read by MySQL client applications.</span></span><br><span class="line"><span class="comment"># Note that only client applications shipped by MySQL are guaranteed</span></span><br><span class="line"><span class="comment"># to read this section. If you want your own MySQL client program to</span></span><br><span class="line"><span class="comment"># honor these values, you need to specify it as an option during the</span></span><br><span class="line"><span class="comment"># MySQL client library initialization.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="comment">#password =1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pipe</span></span><br><span class="line"><span class="comment"># socket=mysql</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="comment"># SERVER SECTION</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following options will be read by the MySQL Server. Make sure that</span></span><br><span class="line"><span class="comment"># you have installed the server correctly (see above) so it reads this </span></span><br><span class="line"><span class="comment"># file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># server_type=3</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The next three options are mutually exclusive to SERVER_PORT below.</span></span><br><span class="line"><span class="comment"># skip-networking</span></span><br><span class="line"><span class="comment"># enable-named-pipe</span></span><br><span class="line"><span class="comment"># The Pipe the MySQL Server will use</span></span><br><span class="line"><span class="comment"># socket=mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The TCP/IP Port the MySQL Server will listen on</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to installation directory. All paths are usually resolved relative to this.</span></span><br><span class="line"><span class="attr">basedir</span>=%MYSQL_HOME%</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the database root</span></span><br><span class="line"><span class="attr">datadir</span>=%MYSQL_HOME%/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># The default character set that will be used when a new schema or table is</span></span><br><span class="line"><span class="comment"># created and no character set is defined</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># The default storage engine that will be used when create new tables when</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the SQL mode to strict</span></span><br><span class="line"><span class="attr">sql-mode</span>=<span class="string">"STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Windows Authentication</span></span><br><span class="line"><span class="comment"># plugin-load=authentication_windows.dll</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># General and Slow logging.</span></span><br><span class="line"><span class="attr">log-output</span>=NONE</span><br><span class="line"><span class="attr">general-log</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">general_log_file</span>=<span class="string">"database-mysql.log"</span></span><br><span class="line"><span class="attr">slow-query-log</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">slow_query_log_file</span>=<span class="string">"database-mysql-slow.log"</span></span><br><span class="line"><span class="attr">long_query_time</span>=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Binary Logging.</span></span><br><span class="line"><span class="comment"># log-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Error Logging.</span></span><br><span class="line"><span class="attr">log-error</span>=<span class="string">"database-mysql.err"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum amount of concurrent sessions the MySQL server will</span></span><br><span class="line"><span class="comment"># allow. One of these connections will be reserved for a user with</span></span><br><span class="line"><span class="comment"># SUPER privileges to allow the administrator to login even if the</span></span><br><span class="line"><span class="comment"># connection limit has been reached.</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Query cache is used to cache SELECT results and later return them</span></span><br><span class="line"><span class="comment"># without actual executing the same query once again. Having the query</span></span><br><span class="line"><span class="comment"># cache enabled may result in significant speed improvements, if your</span></span><br><span class="line"><span class="comment"># have a lot of identical queries and rarely changing tables. See the</span></span><br><span class="line"><span class="comment"># "Qcache_lowmem_prunes" status variable to check if the current value</span></span><br><span class="line"><span class="comment"># is high enough for your load.</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> In case your tables change very often or if your queries are</span></span><br><span class="line"><span class="comment"># textually different every time, the query cache may result in a</span></span><br><span class="line"><span class="comment"># slowdown instead of a performance improvement.</span></span><br><span class="line"><span class="attr">query_cache_size</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The number of open tables for all threads. Increasing this value</span></span><br><span class="line"><span class="comment"># increases the number of file descriptors that mysqld requires.</span></span><br><span class="line"><span class="comment"># Therefore you have to make sure to set the amount of open files</span></span><br><span class="line"><span class="comment"># allowed to at least 4096 in the variable "open-files-limit" in</span></span><br><span class="line"><span class="comment"># section [mysqld_safe]</span></span><br><span class="line"><span class="attr">table_open_cache</span>=<span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Maximum size for internal (in-memory) temporary tables. If a table</span></span><br><span class="line"><span class="comment"># grows larger than this value, it is automatically converted to disk</span></span><br><span class="line"><span class="comment"># based table This limitation is for a single table. There can be many</span></span><br><span class="line"><span class="comment"># of them.</span></span><br><span class="line"><span class="attr">tmp_table_size</span>=<span class="number">20</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># How many threads we should keep in a cache for reuse. When a client</span></span><br><span class="line"><span class="comment"># disconnects, the client's threads are put in the cache if there aren't</span></span><br><span class="line"><span class="comment"># more than thread_cache_size threads from before.  This greatly reduces</span></span><br><span class="line"><span class="comment"># the amount of thread creations needed if you have a lot of new</span></span><br><span class="line"><span class="comment"># connections. (Normally this doesn't give a notable performance</span></span><br><span class="line"><span class="comment"># improvement if you have a good thread implementation.)</span></span><br><span class="line"><span class="attr">thread_cache_size</span>=<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*** MyISAM Specific options</span></span><br><span class="line"><span class="comment"># The maximum size of the temporary file MySQL is allowed to use while</span></span><br><span class="line"><span class="comment"># recreating the index (during REPAIR, ALTER TABLE or LOAD DATA INFILE.</span></span><br><span class="line"><span class="comment"># If the file-size would be bigger than this, the index will be created</span></span><br><span class="line"><span class="comment"># through the key cache (which is slower).</span></span><br><span class="line"><span class="attr">myisam_max_sort_file_size</span>=<span class="number">100</span>G</span><br><span class="line"></span><br><span class="line"><span class="comment"># If the temporary file used for fast index creation would be bigger</span></span><br><span class="line"><span class="comment"># than using the key cache by the amount specified here, then prefer the</span></span><br><span class="line"><span class="comment"># key cache method.  This is mainly used to force long character keys in</span></span><br><span class="line"><span class="comment"># large tables to use the slower key cache method to create the index.</span></span><br><span class="line"><span class="attr">myisam_sort_buffer_size</span>=<span class="number">39</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of the Key Buffer, used to cache index blocks for MyISAM tables.</span></span><br><span class="line"><span class="comment"># Do not set it larger than 30% of your available memory, as some memory</span></span><br><span class="line"><span class="comment"># is also required by the OS to cache rows. Even if you're not using</span></span><br><span class="line"><span class="comment"># MyISAM tables, you should still set it to 8-64M as it will also be</span></span><br><span class="line"><span class="comment"># used for internal temporary disk tables.</span></span><br><span class="line"><span class="attr">key_buffer_size</span>=<span class="number">8</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of the buffer used for doing full table scans of MyISAM tables.</span></span><br><span class="line"><span class="comment"># Allocated per thread, if a full scan is needed.</span></span><br><span class="line"><span class="attr">read_buffer_size</span>=<span class="number">64</span>K</span><br><span class="line"><span class="attr">read_rnd_buffer_size</span>=<span class="number">256</span>K</span><br><span class="line"></span><br><span class="line"><span class="comment"># This buffer is allocated when MySQL needs to rebuild the index in</span></span><br><span class="line"><span class="comment"># REPAIR, OPTIMZE, ALTER table statements as well as in LOAD DATA INFILE</span></span><br><span class="line"><span class="comment"># into an empty table. It is allocated per thread so be careful with</span></span><br><span class="line"><span class="comment"># large settings.</span></span><br><span class="line"><span class="attr">sort_buffer_size</span>=<span class="number">256</span>K</span><br><span class="line"></span><br><span class="line"><span class="comment">#*** INNODB Specific options ***</span></span><br><span class="line"><span class="comment"># innodb_data_home_dir=0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use this option if you have a MySQL server with InnoDB support enabled</span></span><br><span class="line"><span class="comment"># but you do not plan to use it. This will save memory and disk space</span></span><br><span class="line"><span class="comment"># and speed up some things.</span></span><br><span class="line"><span class="comment"># skip-innodb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Additional memory pool that is used by InnoDB to store metadata</span></span><br><span class="line"><span class="comment"># information.  If InnoDB requires more memory for this purpose it will</span></span><br><span class="line"><span class="comment"># start to allocate it from the OS.  As this is fast enough on most</span></span><br><span class="line"><span class="comment"># recent operating systems, you normally do not need to change this</span></span><br><span class="line"><span class="comment"># value. SHOW INNODB STATUS will display the current amount used.</span></span><br><span class="line"><span class="attr">innodb_additional_mem_pool_size</span>=<span class="number">2</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># If set to 1, InnoDB will flush (fsync) the transaction logs to the</span></span><br><span class="line"><span class="comment"># disk at each commit, which offers full ACID behavior. If you are</span></span><br><span class="line"><span class="comment"># willing to compromise this safety, and you are running small</span></span><br><span class="line"><span class="comment"># transactions, you may set this to 0 or 2 to reduce disk I/O to the</span></span><br><span class="line"><span class="comment"># logs. Value 0 means that the log is only written to the log file and</span></span><br><span class="line"><span class="comment"># the log file flushed to disk approximately once per second. Value 2</span></span><br><span class="line"><span class="comment"># means the log is written to the log file at each commit, but the log</span></span><br><span class="line"><span class="comment"># file is only flushed to disk approximately once per second.</span></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The size of the buffer InnoDB uses for buffering log data. As soon as</span></span><br><span class="line"><span class="comment"># it is full, InnoDB will have to flush it to disk. As it is flushed</span></span><br><span class="line"><span class="comment"># once per second anyway, it does not make sense to have it very large</span></span><br><span class="line"><span class="comment"># (even with long transactions).</span></span><br><span class="line"><span class="attr">innodb_log_buffer_size</span>=<span class="number">1</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDB, unlike MyISAM, uses a buffer pool to cache both indexes and</span></span><br><span class="line"><span class="comment"># row data. The bigger you set this the less disk I/O is needed to</span></span><br><span class="line"><span class="comment"># access data in tables. On a dedicated database server you may set this</span></span><br><span class="line"><span class="comment"># parameter up to 80% of the machine physical memory size. Do not set it</span></span><br><span class="line"><span class="comment"># too large, though, because competition of the physical memory may</span></span><br><span class="line"><span class="comment"># cause paging in the operating system.  Note that on 32bit systems you</span></span><br><span class="line"><span class="comment"># might be limited to 2-3.5G of user level memory per process, so do not</span></span><br><span class="line"><span class="comment"># set it too high.</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span>=<span class="number">97</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of each log file in a log group. You should set the combined size</span></span><br><span class="line"><span class="comment"># of log files to about 25%-100% of your buffer pool size to avoid</span></span><br><span class="line"><span class="comment"># unneeded buffer pool flush activity on log file overwrite. However,</span></span><br><span class="line"><span class="comment"># note that a larger logfile size will increase the time needed for the</span></span><br><span class="line"><span class="comment"># recovery process.</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span>=<span class="number">48</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of threads allowed inside the InnoDB kernel. The optimal value</span></span><br><span class="line"><span class="comment"># depends highly on the application, hardware as well as the OS</span></span><br><span class="line"><span class="comment"># scheduler properties. A too high value may lead to thread thrashing.</span></span><br><span class="line"><span class="attr">innodb_thread_concurrency</span>=<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The increment size (in MB) for extending the size of an auto-extend InnoDB system tablespace file when it becomes full.</span></span><br><span class="line"><span class="attr">innodb_autoextend_increment</span>=<span class="number">64</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># The number of regions that the InnoDB buffer pool is divided into.</span></span><br><span class="line"><span class="comment"># For systems with buffer pools in the multi-gigabyte range, dividing the buffer pool into separate instances can improve concurrency,</span></span><br><span class="line"><span class="comment"># by reducing contention as different threads read and write to cached pages.</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_instances</span>=<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Determines the number of threads that can enter InnoDB concurrently.</span></span><br><span class="line"><span class="attr">innodb_concurrency_tickets</span>=<span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies how long in milliseconds (ms) a block inserted into the old sublist must stay there after its first access before</span></span><br><span class="line"><span class="comment"># it can be moved to the new sublist.</span></span><br><span class="line"><span class="attr">innodb_old_blocks_time</span>=<span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># It specifies the maximum number of .ibd files that MySQL can keep open at one time. The minimum value is 10.</span></span><br><span class="line"><span class="attr">innodb_open_files</span>=<span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When this variable is enabled, InnoDB updates statistics during metadata statements.</span></span><br><span class="line"><span class="attr">innodb_stats_on_metadata</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When innodb_file_per_table is enabled (the default in 5.6.6 and higher), InnoDB stores the data and indexes for each newly created table</span></span><br><span class="line"><span class="comment"># in a separate .ibd file, rather than in the system tablespace.</span></span><br><span class="line"><span class="attr">innodb_file_per_table</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the following list of values: 0 for crc32, 1 for strict_crc32, 2 for innodb, 3 for strict_innodb, 4 for none, 5 for strict_none.</span></span><br><span class="line"><span class="attr">innodb_checksum_algorithm</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The number of outstanding connection requests MySQL can have.</span></span><br><span class="line"><span class="comment"># This option is useful when the main MySQL thread gets many connection requests in a very short time.</span></span><br><span class="line"><span class="comment"># It then takes some time (although very little) for the main thread to check the connection and start a new thread.</span></span><br><span class="line"><span class="comment"># The back_log value indicates how many requests can be stacked during this short time before MySQL momentarily</span></span><br><span class="line"><span class="comment"># stops answering new requests.</span></span><br><span class="line"><span class="comment"># You need to increase this only if you expect a large number of connections in a short period of time.</span></span><br><span class="line"><span class="attr">back_log</span>=<span class="number">70</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If this is set to a nonzero value, all tables are closed every flush_time seconds to free up resources and</span></span><br><span class="line"><span class="comment"># synchronize unflushed data to disk.</span></span><br><span class="line"><span class="comment"># This option is best used only on systems with minimal resources.</span></span><br><span class="line"><span class="attr">flush_time</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The minimum size of the buffer that is used for plain index scans, range index scans, and joins that do not use</span></span><br><span class="line"><span class="comment"># indexes and thus perform full table scans.</span></span><br><span class="line"><span class="attr">join_buffer_size</span>=<span class="number">256</span>K</span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum size of one packet or any generated or intermediate string, or any parameter sent by the</span></span><br><span class="line"><span class="comment"># mysql_stmt_send_long_data() C API function.</span></span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="number">4</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># If more than this many successive connection requests from a host are interrupted without a successful connection,</span></span><br><span class="line"><span class="comment"># the server blocks that host from performing further connections.</span></span><br><span class="line"><span class="attr">max_connect_errors</span>=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Changes the number of file descriptors available to mysqld.</span></span><br><span class="line"><span class="comment"># You should try increasing the value of this option if mysqld gives you the error "Too many open files".</span></span><br><span class="line"><span class="attr">open_files_limit</span>=<span class="number">4110</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the query cache type. 0 for OFF, 1 for ON and 2 for DEMAND.</span></span><br><span class="line"><span class="attr">query_cache_type</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you see many sort_merge_passes per second in SHOW GLOBAL STATUS output, you can consider increasing the</span></span><br><span class="line"><span class="comment"># sort_buffer_size value to speed up ORDER BY or GROUP BY operations that cannot be improved with query optimization</span></span><br><span class="line"><span class="comment"># or improved indexing.</span></span><br><span class="line"><span class="attr">sort_buffer_size</span>=<span class="number">256</span>K</span><br><span class="line"></span><br><span class="line"><span class="comment"># The number of table definitions (from .frm files) that can be stored in the definition cache.</span></span><br><span class="line"><span class="comment"># If you use a large number of tables, you can create a large table definition cache to speed up opening of tables.</span></span><br><span class="line"><span class="comment"># The table definition cache takes less space and does not use file descriptors, unlike the normal table cache.</span></span><br><span class="line"><span class="comment"># The minimum and default values are both 400.</span></span><br><span class="line"><span class="attr">table_definition_cache</span>=<span class="number">1400</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the maximum size of a row-based binary log event, in bytes.</span></span><br><span class="line"><span class="comment"># Rows are grouped into events smaller than this size if possible. The value should be a multiple of 256.</span></span><br><span class="line"><span class="attr">binlog_row_event_max_size</span>=<span class="number">8</span>K</span><br><span class="line"></span><br><span class="line"><span class="comment"># If the value of this variable is greater than 0, a replication slave synchronizes its master.info file to disk.</span></span><br><span class="line"><span class="comment"># (using fdatasync()) after every sync_master_info events.</span></span><br><span class="line"><span class="attr">sync_master_info</span>=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If the value of this variable is greater than 0, the MySQL server synchronizes its relay log to disk.</span></span><br><span class="line"><span class="comment"># (using fdatasync()) after every sync_relay_log writes to the relay log.</span></span><br><span class="line"><span class="attr">sync_relay_log</span>=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If the value of this variable is greater than 0, a replication slave synchronizes its relay-log.info file to disk.</span></span><br><span class="line"><span class="comment"># (using fdatasync()) after every sync_relay_log_info transactions.</span></span><br><span class="line"><span class="attr">sync_relay_log_info</span>=<span class="number">10000</span></span><br></pre></td></tr></table></figure><p>注：如果初始化过程中提示找不到路径<code>basedir</code>和<code>datadir</code>修改为绝对路径</p><h2 id="数据库初始化"><a href="#数据库初始化" class="headerlink" title="数据库初始化"></a>数据库初始化</h2><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><ul><li><p>通过cmd窗口执行初始化数据库命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --console</span><br></pre></td></tr></table></figure><p>注：此命令执行成功会在<code>MYSQL_HOME/data</code>下生成一些文件及root用户初始密码。</p><img src="/contents/20190328112159/init.jpg" title="数据库初始化"><p>注：红色部分为初始密码需要记录，也可在<code>MYSQL_HOME/data</code>路径下<code>主机名.err</code>文件中找到</p></li></ul><h2 id="服务安装及启动"><a href="#服务安装及启动" class="headerlink" title="服务安装及启动"></a>服务安装及启动</h2><ul><li>以管理员身份运行cmd窗口，执行下面的命令</li></ul><h3 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h3><ul><li><p>将mysql服务安装到服务列表中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld install</span><br></pre></td></tr></table></figure></li></ul><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><ul><li><p>启动mysql服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mysql</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装完成测试"><a href="#安装完成测试" class="headerlink" title="安装完成测试"></a>安装完成测试</h2><ul><li><p>通过工具<code>Navicat Premium</code>连接，登陆成功</p><img src="/contents/20190328112159/ok.jpg" title="登陆成功"><p>注：第一次登陆会提示修改密码</p></li></ul><h2 id="卸载MySQL数据库"><a href="#卸载MySQL数据库" class="headerlink" title="卸载MySQL数据库"></a>卸载MySQL数据库</h2><ul><li>MySQL卸载步骤进行如下整理</li></ul><h3 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h3><ul><li><p>通过cmd窗口执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net stop mysql</span><br></pre></td></tr></table></figure></li></ul><h3 id="卸载服务"><a href="#卸载服务" class="headerlink" title="卸载服务"></a>卸载服务</h3><ul><li><p>通过cmd窗口执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld -remove</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除环境变量"><a href="#删除环境变量" class="headerlink" title="删除环境变量"></a>删除环境变量</h3><ul><li>删除MySQL相关的环境变量</li></ul><h3 id="删除解压包"><a href="#删除解压包" class="headerlink" title="删除解压包"></a>删除解压包</h3><ul><li>删除MySQL解压包，卸载完成</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;安装配置及卸载MySQL8社区版&quot;&gt;&lt;a href=&quot;#安装配置及卸载MySQL8社区版&quot; class=&quot;headerlink&quot; title=&quot;安装配置及卸载MySQL8社区版&quot;&gt;&lt;/a&gt;安装配置及卸载MySQL8社区版&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="程序安装" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85/"/>
    
    
      <category term="mysql安装" scheme="https://blog.jyusun.com/tags/mysql%E5%AE%89%E8%A3%85/"/>
    
      <category term="mysql卸载" scheme="https://blog.jyusun.com/tags/mysql%E5%8D%B8%E8%BD%BD/"/>
    
      <category term="mysql8" scheme="https://blog.jyusun.com/tags/mysql8/"/>
    
  </entry>
  
  <entry>
    <title>设置yum阿里源或本地源</title>
    <link href="https://blog.jyusun.com/contents/20190321110041.html"/>
    <id>https://blog.jyusun.com/contents/20190321110041.html</id>
    <published>2019-03-21T03:00:41.000Z</published>
    <updated>2020-02-14T04:26:38.963Z</updated>
    
    <content type="html"><![CDATA[<h1 id="设置yum阿里源或本地源"><a href="#设置yum阿里源或本地源" class="headerlink" title="设置yum阿里源或本地源"></a>设置yum阿里源或本地源</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>Yum（全称为 Yellow dog Updater, Modified）是一个在Fedora和RedHat以及CentOS中的<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9TaGVsbA==" title="https://baike.baidu.com/item/Shell">Shell<i class="fa fa-external-link"></i></span>前端软件包管理器。基于<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9SUE0=" title="https://baike.baidu.com/item/RPM">RPM<i class="fa fa-external-link"></i></span>包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。摘自：<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS95dW0vMjgzNTc3MT9mcj1hbGFkZGlu" title="https://baike.baidu.com/item/yum/2835771?fr=aladdin">百度百科<i class="fa fa-external-link"></i></span></li><li>场景1：CentOS默认的yum软件仓库源是境外的，虽然没有被墙，但是有时候下载些软件也还是很慢的，所以将yum源改阿里软件仓库源。</li><li>场景2：CentOS服务器处在内网环境中，缺少依赖手动安装那么会非常麻烦，需要花费大量时间寻找rpm包及相互间依赖的包在上传。现在搭建本地的yum软件仓库源，解决环境是无法联网的情况下，要使用yum的问题。</li></ul><h2 id="阿里软件仓库源"><a href="#阿里软件仓库源" class="headerlink" title="阿里软件仓库源"></a>阿里软件仓库源</h2><h3 id="备份基础源"><a href="#备份基础源" class="headerlink" title="备份基础源"></a>备份基础源</h3><ul><li><p>切换到yum源配置路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure></li><li><p>备份文件，重命名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv CentOS-Base.repo CentOS-Base.repo_bak</span><br></pre></td></tr></table></figure></li></ul><h3 id="阿里软件仓库源-CentOS7"><a href="#阿里软件仓库源-CentOS7" class="headerlink" title="阿里软件仓库源-CentOS7"></a>阿里软件仓库源-CentOS7</h3><ul><li><p>下载阿里云</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure></li><li><p>生成元数据缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure></li><li><p>查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist</span><br></pre></td></tr></table></figure><blockquote><p>已加载插件：fastestmirror<br>Loading mirror speeds from cached hostfile<br> * base: mirrors.aliyun.com<br> * extras: mirrors.aliyun.com<br> * updates: mirrors.aliyun.com</p></blockquote><h3 id="阿里软件仓库源-CentOS8"><a href="#阿里软件仓库源-CentOS8" class="headerlink" title="阿里软件仓库源-CentOS8"></a>阿里软件仓库源-CentOS8</h3></li><li><p>下载阿里云</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo</span><br></pre></td></tr></table></figure></li><li><p>编辑AppStream</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim CentOS-AppStream.repo</span><br></pre></td></tr></table></figure><blockquote><p>[AppStream]<br>name=CentOS-$releasever - AppStream<br>#mirrorlist=<span class="exturl" data-url="aHR0cDovL21pcnJvcmxpc3QuY2VudG9zLm9yZy8/cmVsZWFzZT0kcmVsZWFzZXZlciZhbXA7YXJjaD0kYmFzZWFyY2gmYW1wO3JlcG89QXBwU3RyZWFtJmFtcDtpbmZyYT0kaW5mcmE=" title="http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=AppStream&amp;infra=$infra">http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=AppStream&amp;infra=$infra<i class="fa fa-external-link"></i></span><br>#baseurl=<span class="exturl" data-url="aHR0cDovL21pcnJvci5jZW50b3Mub3JnLyRjb250ZW50ZGlyLyRyZWxlYXNldmVyL0FwcFN0cmVhbS8kYmFzZWFyY2gvb3Mv" title="http://mirror.centos.org/$contentdir/$releasever/AppStream/$basearch/os/">http://mirror.centos.org/$contentdir/$releasever/AppStream/$basearch/os/<i class="fa fa-external-link"></i></span><br>baseurl=<span class="exturl" data-url="aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS8kY29udGVudGRpci8kcmVsZWFzZXZlci9BcHBTdHJlYW0vJGJhc2VhcmNoL29zLw==" title="http://mirrors.aliyun.com/$contentdir/$releasever/AppStream/$basearch/os/">http://mirrors.aliyun.com/$contentdir/$releasever/AppStream/$basearch/os/<i class="fa fa-external-link"></i></span><br>gpgcheck=1<br>enabled=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</p></blockquote></li><li><p>编辑Extras</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi CentOS-Extras.repo</span><br></pre></td></tr></table></figure><blockquote><p>#additional packages that may be useful<br>[extras]<br>name=CentOS-$releasever - Extras<br>#mirrorlist=<span class="exturl" data-url="aHR0cDovL21pcnJvcmxpc3QuY2VudG9zLm9yZy8/cmVsZWFzZT0kcmVsZWFzZXZlciZhbXA7YXJjaD0kYmFzZWFyY2gmYW1wO3JlcG89ZXh0cmFzJmFtcDtpbmZyYT0kaW5mcmE=" title="http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra">http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra<i class="fa fa-external-link"></i></span><br>#baseurl=<span class="exturl" data-url="aHR0cDovL21pcnJvci5jZW50b3Mub3JnLyRjb250ZW50ZGlyLyRyZWxlYXNldmVyL2V4dHJhcy8kYmFzZWFyY2gvb3Mv" title="http://mirror.centos.org/$contentdir/$releasever/extras/$basearch/os/">http://mirror.centos.org/$contentdir/$releasever/extras/$basearch/os/<i class="fa fa-external-link"></i></span><br>baseurl=<span class="exturl" data-url="aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS8kY29udGVudGRpci8kcmVsZWFzZXZlci9leHRyYXMvJGJhc2VhcmNoL29zLw==" title="http://mirrors.aliyun.com/$contentdir/$releasever/extras/$basearch/os/">http://mirrors.aliyun.com/$contentdir/$releasever/extras/$basearch/os/<i class="fa fa-external-link"></i></span></p><p>gpgcheck=1<br>enabled=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</p></blockquote></li><li><p>生成元数据缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure></li><li><p>查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist</span><br></pre></td></tr></table></figure><blockquote><p>已加载插件：fastestmirror<br>Loading mirror speeds from cached hostfile<br> * base: mirrors.aliyun.com<br> * extras: mirrors.aliyun.com<br> * updates: mirrors.aliyun.com</p></blockquote></li></ul><h2 id="本地软件仓库源"><a href="#本地软件仓库源" class="headerlink" title="本地软件仓库源"></a>本地软件仓库源</h2><h3 id="备份所有源数据并删除"><a href="#备份所有源数据并删除" class="headerlink" title="备份所有源数据并删除"></a>备份所有源数据并删除</h3><ul><li><p>切换路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure></li><li><p>CentOS源打包备份，避免读到其他源中配置外网而读取不到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zcvf repo_bak.tar.gz CentOS-*</span><br></pre></td></tr></table></figure></li><li><p>删除所有源数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf *.repo</span><br></pre></td></tr></table></figure></li></ul><h3 id="ISO挂载"><a href="#ISO挂载" class="headerlink" title="ISO挂载"></a>ISO挂载</h3><ul><li><p>查看一下，光驱的位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><img src="/contents/20190321110041/lsblk.jpg" title="sr1"><p>在实体机中配置的时候，一般不去查看lsblk的结果。就认作是/dev/cdrom，虚拟机中则会指向虚拟盘。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /dev/cdrom</span><br></pre></td></tr></table></figure><img src="/contents/20190321110041/ll.jpg" title="sr0"><p>注：可以看到/dev/cdrom实际上是sr0的符号链接。而我们虚拟中光驱的位置是sr1</p></li><li><p>要使用光驱里的镜像文件，需要将它挂载到当前系统上。这个挂载位置称为挂载点，通常是在 /mnt/ 或者 /media/ 目录下，创建一个子目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/cdrom</span><br></pre></td></tr></table></figure></li><li><p>手动挂载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sr1 /mnt/cdrom</span><br></pre></td></tr></table></figure></li><li><p>开启激动自动挂载</p><p>编辑文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/fstab/</span><br></pre></td></tr></table></figure><p>写入</p><p><code>/dev/sr1 /mnt/cdrom iso9660 defaults 0 1</code></p></li></ul><table><thead><tr><th>设备位置</th><th>挂载点</th><th>文件系统</th><th>挂载选项</th><th>是否备份</th><th>检查文件系统的顺序</th></tr></thead><tbody><tr><td>/dev/sr1</td><td>/mnt/cdrom</td><td>iso9660</td><td>defaults</td><td>0</td><td>1</td></tr></tbody></table><ul><li><p>查看挂载并生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br></pre></td></tr></table></figure><p>注：CentOS7如果不执行这个命令直接重启可能会出现一些错误。</p></li></ul><h3 id="设置本地源"><a href="#设置本地源" class="headerlink" title="设置本地源"></a>设置本地源</h3><ul><li><p>新建本地源文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/yum.repos.d/CentOS-Local.repo</span><br></pre></td></tr></table></figure><blockquote><p>[Local]<br>name=local yum<br>baseurl=file:///mnt/cdrom<br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-KEY-CentOS-7<br>enbled=1</p></blockquote></li></ul><table><thead><tr><th>字段</th><th>解释</th></tr></thead><tbody><tr><td>[ ]</td><td>软件仓库服务器的id，保证不能已有的仓库id名重复</td></tr><tr><td>name</td><td>是仓库的名字，也任意</td></tr><tr><td>baseurl</td><td>基础路径。它支持三种协议http、ftp、file。图中的file:///mnt/cdrom分成两段来理解：file://(协议名) ， /mnt/cdrom（挂载点）。若有多个baseurl则依次写出</td></tr><tr><td>gpgcheck</td><td>gpg密钥检查字段，值1为则检查gpg密钥，0为不检查</td></tr><tr><td>gpgkey</td><td>gpg密钥所在路径。最后的文件名可能不同centos版本不同。提前检查一下你的/etc/pki/rpm-gpg目录中的文件</td></tr><tr><td>enable</td><td>是否启用该仓库服务器，值为1则启用，0为不启用</td></tr></tbody></table><ul><li><p>生成元数据缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><img src="/contents/20190321110041/local_source_cache.jpg" title="本地源元数据缓存生成"></li><li><p>查看软件仓库源状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all</span><br></pre></td></tr></table></figure><img src="/contents/20190321110041/local_source_enable.jpg" title="本地源已启用"></li><li><p>测试</p><img src="/contents/20190321110041/local_source_test.jpg" title="本地源测试"></li></ul><h2 id="局域网软件仓库源"><a href="#局域网软件仓库源" class="headerlink" title="局域网软件仓库源"></a>局域网软件仓库源</h2><ul><li>使用ftp、nginx或Apache服务器，启用并配置可访问到挂载文件夹，在指定baseurl即可。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;设置yum阿里源或本地源&quot;&gt;&lt;a href=&quot;#设置yum阿里源或本地源&quot; class=&quot;headerlink&quot; title=&quot;设置yum阿里源或本地源&quot;&gt;&lt;/a&gt;设置yum阿里源或本地源&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="系统配置" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="yum源" scheme="https://blog.jyusun.com/tags/yum%E6%BA%90/"/>
    
      <category term="yum本地源" scheme="https://blog.jyusun.com/tags/yum%E6%9C%AC%E5%9C%B0%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>Hexo-Next7.0主题博客优化</title>
    <link href="https://blog.jyusun.com/contents/20190320112238.html"/>
    <id>https://blog.jyusun.com/contents/20190320112238.html</id>
    <published>2019-03-20T03:22:38.000Z</published>
    <updated>2019-03-20T03:22:38.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexo-Next7-0主题博客优化"><a href="#Hexo-Next7-0主题博客优化" class="headerlink" title="Hexo-Next7.0主题博客优化"></a>Hexo-Next7.0主题博客优化</h1><h2 id="基础路径说明"><a href="#基础路径说明" class="headerlink" title="基础路径说明"></a>基础路径说明</h2><table><thead><tr><th>名称</th><th>文件</th><th>URL</th></tr></thead><tbody><tr><td>根路径</td><td>BLOG_HEXO</td><td>BLOG_HEXO/</td></tr><tr><td>站点配置文件</td><td>_config.yml</td><td>BLOG_HEXO/_config.yml</td></tr><tr><td>主题配置文件</td><td>_config.yml</td><td>BLOG_HEXO/themes/next/_config.yml</td></tr></tbody></table><p>注：下文中术语以此为准自行匹配</p><h2 id="Hexo站点配置"><a href="#Hexo站点配置" class="headerlink" title="Hexo站点配置"></a>Hexo站点配置</h2><h3 id="站点基础配置"><a href="#站点基础配置" class="headerlink" title="站点基础配置"></a>站点基础配置</h3><ul><li><p>Site</p><blockquote><p>title: EvanSun Home<br>subtitle: 记录、分享<br>description: 男人有实力，才有魅力~<br>keywords:<br>author: evansun<br>language: zh-Hans #指定语言<br>timezone: Asia/Shanghai #指定时区</p></blockquote></li></ul><h3 id="URL访问配置"><a href="#URL访问配置" class="headerlink" title="URL访问配置"></a>URL访问配置</h3><ul><li><p>站点配置文件，关键字：<code>URL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url: https://blog.jyusun.com</span><br><span class="line">root: /</span><br><span class="line">permalink: contents/:id.html</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure></li></ul><h3 id="指定next主题"><a href="#指定next主题" class="headerlink" title="指定next主题"></a>指定next主题</h3><ul><li><p>克隆next主题到themes文件夹下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></li><li><p>站点配置文件，关键字：<code>theme</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: next</span><br></pre></td></tr></table></figure></li></ul><h3 id="指定next-Pisces模板"><a href="#指定next-Pisces模板" class="headerlink" title="指定next-Pisces模板"></a>指定next-Pisces模板</h3><ul><li><p>主题配置文件，关键字：<code>Schemes</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#scheme: Muse</span><br><span class="line">#scheme: Mist</span><br><span class="line">scheme: Pisces  #打开前面的注释</span><br><span class="line">#scheme: Gemini</span><br></pre></td></tr></table></figure></li></ul><h3 id="部署设置"><a href="#部署设置" class="headerlink" title="部署设置"></a>部署设置</h3><ul><li><p>站点配置文件，关键字：<code>deploy</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:jyusun/blog.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></li></ul><h3 id="文章生成位置及名称"><a href="#文章生成位置及名称" class="headerlink" title="文章生成位置及名称"></a>文章生成位置及名称</h3><ul><li><p>站点配置文件，设置文章生成位置及名称，关键字：<code>new_post_name</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_post_name: :year:month:day-:title/index.md # File name of new posts</span><br></pre></td></tr></table></figure><p>生成效果：20190319-测试文件/index.md</p></li></ul><h2 id="菜单栏设置"><a href="#菜单栏设置" class="headerlink" title="菜单栏设置"></a>菜单栏设置</h2><h3 id="设置展示菜单"><a href="#设置展示菜单" class="headerlink" title="设置展示菜单"></a>设置展示菜单</h3><ul><li><p>增加菜单<code>主题/languages/zh-CH.yml</code>，关键字：<code>menu</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">home: 首页</span><br><span class="line">  archives: 归档</span><br><span class="line">  categories: 分类</span><br><span class="line">  tags: 标签</span><br><span class="line">  about: 关于</span><br><span class="line">  search: 搜索</span><br><span class="line">  schedule: 日程表</span><br><span class="line">  sitemap: 站点地图</span><br><span class="line">  commonweal: 公益404</span><br><span class="line">  test: 测试新增</span><br></pre></td></tr></table></figure><p>注：由于上面站点基础配置中指定了语言zh-CH，所以本文以此为例。</p></li><li><p>主题配置文件，关键字：<code>menu</code>打开需要菜单的注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  tags: /tags/ || tags</span><br><span class="line">  categories: /categories/ || th</span><br><span class="line">  archives: /archives/ || archive</span><br><span class="line">  schedule: /schedule/ || calendar</span><br><span class="line">  sitemap: /sitemap.xml || sitemap</span><br><span class="line">  commonweal: /404/ || heartbeat</span><br><span class="line">  about: /about/ || user</span><br><span class="line">  test: /test/ || test</span><br></pre></td></tr></table></figure></li></ul><h3 id="设置文章分类页面"><a href="#设置文章分类页面" class="headerlink" title="设置文章分类页面"></a>设置文章分类页面</h3><ul><li><p>新建分类页面<code>categories</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br></pre></td></tr></table></figure><p>注：根路径下执行此命令</p></li><li><p>修改页面内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​</span><br></pre></td></tr></table></figure><p>title: 文章分类<br>date: 2018-07-19 14:08:34<br>type: “categories”<br>​<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure></p><p>注：使用时在文章标题处指定<code>categories</code>标签即可</p></li></ul><h3 id="站点地图"><a href="#站点地图" class="headerlink" title="站点地图"></a>站点地图</h3><ul><li><p>安装插件，分别适用于谷歌和百度生成站点地图便于爬虫爬取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure></li><li><p>站点配置文件，新增内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Plugins:</span><br><span class="line">  - hexo-generator-baidu-sitemap</span><br><span class="line">  - hexo-generator-sitemap</span><br><span class="line">baidusitemap:</span><br><span class="line">  path: baidusitemap.xml</span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br></pre></td></tr></table></figure></li></ul><h3 id="公益404"><a href="#公益404" class="headerlink" title="公益404"></a>公益404</h3><ul><li>待续…</li></ul><h3 id="添加站内搜索功能"><a href="#添加站内搜索功能" class="headerlink" title="添加站内搜索功能"></a>添加站内搜索功能</h3><ul><li><p>下载插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure></li><li><p>站点配置文件，新增内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 设置站内搜索</span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure></li><li><p>主题配置文件，关键字：<code>local_search</code>，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Local search</span><br><span class="line"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</span><br><span class="line">local_search:</span><br><span class="line">  enable: true  #设置为true</span><br><span class="line">  # If auto, trigger search by changing input.</span><br><span class="line">  # If manual, trigger search by pressing enter key or search button.</span><br><span class="line">  trigger: auto</span><br><span class="line">  # Show top n results per article, show all results by setting to -1</span><br><span class="line">  top_n_per_article: 1</span><br><span class="line">  # Unescape html strings to the readable one.</span><br><span class="line">  unescape: false</span><br></pre></td></tr></table></figure></li></ul><h2 id="侧边栏设置"><a href="#侧边栏设置" class="headerlink" title="侧边栏设置"></a>侧边栏设置</h2><h3 id="设置头像"><a href="#设置头像" class="headerlink" title="设置头像"></a>设置头像</h3><ul><li><p>主题配置文件，关键字：<code>Sidebar Avatar</code></p><p>avatar指定本地图片,把图片放入 <code>themes/next/source/images</code> 下,修改 <code>avatar</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">avatar: </span><br><span class="line">  url: /images/touxiang.png</span><br><span class="line">  rounded: false</span><br><span class="line">  opacity: 1</span><br><span class="line">  rotated: false</span><br></pre></td></tr></table></figure></li></ul><h3 id="设置侧边社交连接"><a href="#设置侧边社交连接" class="headerlink" title="设置侧边社交连接"></a>设置侧边社交连接</h3><ul><li><p>主题配置文件，关键字： <code>Social Links</code>，根据需要打开注释，调整为自己的地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">social:</span><br><span class="line">  GitHub: https://github.com/jyusun || github</span><br><span class="line">  E-Mail: mailto:mr.evansun@foxmail.com || envelope</span><br></pre></td></tr></table></figure></li></ul><h3 id="设置侧边栏社交样式"><a href="#设置侧边栏社交样式" class="headerlink" title="设置侧边栏社交样式"></a>设置侧边栏社交样式</h3><ul><li><p>主题配置文件，关键字： <code>social_icons</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">social_icons:</span><br><span class="line">  enable: true      #`true`显示图标，`false`只显示名称</span><br><span class="line">  icons_only: false  #`true`只展示图标，`false`显示图标及名称</span><br><span class="line">  transition: false</span><br></pre></td></tr></table></figure></li></ul><h3 id="RSS"><a href="#RSS" class="headerlink" title="RSS"></a>RSS</h3><ul><li><p>安装feed插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure></li><li><p>主题配置文件，新增内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># feed</span><br><span class="line"># Dependencies: https://github.com/hexojs/hexo-generator-feed</span><br><span class="line">feed:</span><br><span class="line">  type: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  limit: 20</span><br><span class="line">  hub:</span><br><span class="line">  content:</span><br><span class="line">  content_limit: 140</span><br><span class="line">  content_limit_delim: &apos; &apos;</span><br><span class="line">  order_by: -date</span><br><span class="line">  icon: icon.png</span><br></pre></td></tr></table></figure></li></ul><h3 id="友情链接"><a href="#友情链接" class="headerlink" title="友情链接"></a>友情链接</h3><ul><li><p>主题配置文件，关键字：<code>Blog rolls</code> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Blog rolls</span><br><span class="line">links_icon: link</span><br><span class="line">links_title: Links</span><br><span class="line">links_layout: block</span><br><span class="line">#links_layout: inline</span><br><span class="line">links:</span><br><span class="line">  开源中国: https://www.oschina.net/</span><br><span class="line">  百度: http://baidu.com/</span><br><span class="line">  搜狗: https://www.sogou.com/</span><br></pre></td></tr></table></figure></li></ul><h2 id="底部设置"><a href="#底部设置" class="headerlink" title="底部设置"></a>底部设置</h2><h3 id="推广链接功能"><a href="#推广链接功能" class="headerlink" title="推广链接功能"></a>推广链接功能</h3><ul><li><p><code>主题/layout/_macro</code>路径下新增<code>advert.swig</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;# Gallery support #&#125;</span><br><span class="line">&#123;% if config.advert %&#125;</span><br><span class="line">&lt;div class=&quot;post-gallery&quot; itemscope itemtype=&quot;http://schema.org/ImageGallery&quot;&gt;</span><br><span class="line">  &#123;% set COLUMN_NUMBER = 3 %&#125;</span><br><span class="line">  &#123;% for advert, link in config.advert %&#125;</span><br><span class="line">&#123;% if loop.index0 % COLUMN_NUMBER === 0 %&#125;&lt;div class=&quot;post-gallery-row&quot;&gt;&#123;% endif %&#125;</span><br><span class="line">  &lt;a class=&quot;post-gallery-img fancybox&quot;</span><br><span class="line"> href=&quot;&#123;&#123; link.split(&apos;||&apos;)[1] | trim &#125;&#125;&quot; rel=&quot;gallery_&#123;&#123; post._id &#125;&#125;&quot; target=&quot;_blank&quot;</span><br><span class="line"> itemscope itemtype=&quot;http://schema.org/ImageObject&quot; itemprop=&quot;url&quot;&gt;</span><br><span class="line">&lt;img src=&quot;&#123;&#123; link.split(&apos;||&apos;)[0] | trim &#125;&#125;&quot; itemprop=&quot;contentUrl&quot; alt=&quot;&#123;&#123;advert&#125;&#125;&quot;/&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&#123;% if loop.index0 % COLUMN_NUMBER === 2 %&#125;&lt;/div&gt;&#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">  &#123;# Append end tag for `post-gallery-row` when (photos size mod COLUMN_NUMBER) is less than COLUMN_NUMBER #&#125;</span><br><span class="line">  &#123;% if config.advert.length % COLUMN_NUMBER &gt; 0 %&#125;&lt;/div&gt;&#123;% endif %&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>将代码插入<code>主题/layout/_macro/post.swig</code>文件中，关键字：<code>theme.wechat_subscriber.enabled</code>上方</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.advert.enable and not is_index%&#125;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &#123;% include &apos;advert.swig&apos; %&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>主题配置文件，新增用于控制推广功能开关</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">advert:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure></li><li><p>站点配置文件，新增推广内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">advert:</span><br><span class="line">天猫618: https://gw.alicdn.com/tfs/TB1p12MsQ9WBuNjSspeXXaz5VXa-440-180.jpg || https://s.click.taobao.com/t?e=m%3D2%26s%3DQ7%2BOxHRJNU8cQipKwQzePCperVdZeJviK7Vc7tFgwiFRAdhuF14FMSjJriMKVvzd5x%2BIUlGKNpUKzRB5pSb%2B3oLgBNn%2Fh8Y9fs5VlYBlFz5kblEZQzGoFcs%2Fhc73tO6KVYo%2BqyT%2FBa1NrKwvDJNPXkIGbLNY5ut4zueC0P1cNS9iw0%2FdWyiVaogaseAKBk0cTbU9KzMTtxpe7auY0HPYWszlTEcWhO9mCmht7GX%2FH9k%3D</span><br><span class="line">2018年618理想生活狂欢季——聚划算主会场: https://img.alicdn.com/tfs/TB125UMsMmTBuNjy1XbXXaMrVXa-440-180.jpg || https://s.click.taobao.com/t?e=m%3D2%26s%3D2c9N%2F89tPiMcQipKwQzePCperVdZeJviK7Vc7tFgwiFRAdhuF14FMXJZeCVJPqDB8sviUM61dt0KzRB5pSb%2B3oLgBNn%2Fh8Y9fs5VlYBlFz5kblEZQzGoFcs%2Fhc73tO6KVYo%2BqyT%2FBa1NrKwvDJNPXkIGbLNY5ut4zueC0P1cNS%2B%2BUEclaRYva8F8WBkZipnv9sOkOOEWZ4E%2FnCA8IhtTQhnqXdg7YFDycSpj5qSCmbA%3D</span><br><span class="line">2018年618理想生活狂欢节—消费电子主会场: https://img.alicdn.com/tfs/TB1GnfasntYBeNjy1XdXXXXyVXa-440-180.jpg || https://s.click.taobao.com/t?e=m%3D2%26s%3D5xcD%2FIEjdhYcQipKwQzePCperVdZeJviK7Vc7tFgwiFRAdhuF14FMUG5eE0BPbCdxq3IhSJN6GQKzRB5pSb%2B3oLgBNn%2Fh8Y9fs5VlYBlFz5kblEZQzGoFcs%2Fhc73tO6KVYo%2BqyT%2FBa1NrKwvDJNPXkIGbLNY5ut4zueC0P1cNS%2B6zThPYvErzhJBFs1%2FyLxVPxey8%2Bhd8pyvTW5l3DCD30V92HL3DKLNSqwyt%2BH6DtO%2FMqT4SeHHMKTHNVRq3ENViYq%2BoOM2USF%2Bn%2B1pvicu6FXll1U39L8dNcwDbqGDeU3JefVee9XDEgxYVk%2BaFSeXxiXvDf8DaRs%3D</span><br></pre></td></tr></table></figure></li></ul><h3 id="文章末尾加上”本文结束”字样"><a href="#文章末尾加上”本文结束”字样" class="headerlink" title="文章末尾加上”本文结束”字样"></a>文章末尾加上”本文结束”字样</h3><ul><li><p><code>主题/layout/_macro</code>，新增<code>passage-end-tag.swig</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if not is_index %&#125;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div style=&quot;text-align:center;color: #ccc;font-size:14px;&quot;&gt;------本文结束------&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>将代码插入<code>主题/layout/_macro/post.swig</code>文件中，关键字：<code>END POST BODY</code>下方</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.passage-end-tag.enable and not is_index %&#125;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">&#123;% include &apos;passage-end-tag.swig&apos; %&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>主题配置文件，新增内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 文章末尾添加“本文结束”标记</span><br><span class="line">passage_end_tag:</span><br><span class="line">  enabled: true</span><br></pre></td></tr></table></figure></li></ul><h3 id="底部标签"><a href="#底部标签" class="headerlink" title="底部标签"></a>底部标签</h3><ul><li><p>底部带有#号的标签<code>主题/layout/_macro/post.swig</code>，关键字：<code>post-footer</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 替换为 &lt;i class=&quot;fa fa-tag&quot;&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="底部统计"><a href="#底部统计" class="headerlink" title="底部统计"></a>底部统计</h3><ul><li><code>主题/layout/_partials/footer.swig</code></li></ul><h2 id="首页文章样式"><a href="#首页文章样式" class="headerlink" title="首页文章样式"></a>首页文章样式</h2><h3 id="主页文章添加阴影效果"><a href="#主页文章添加阴影效果" class="headerlink" title="主页文章添加阴影效果"></a>主页文章添加阴影效果</h3><ul><li><p>新增内容<code>主题/source/css/_custom/custom.styl</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 主页文章添加阴影效果</span><br><span class="line">.post &#123;</span><br><span class="line">   margin-top: 0px;</span><br><span class="line">   margin-bottom: 60px;</span><br><span class="line">   padding: 25px;</span><br><span class="line">   -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);</span><br><span class="line">   -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="隐藏文章与文章间分割线"><a href="#隐藏文章与文章间分割线" class="headerlink" title="隐藏文章与文章间分割线"></a>隐藏文章与文章间分割线</h3><ul><li><p>修改内容<code>主题/source/css/_common/components/post/post-eof.styl</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.posts-expand &#123;</span><br><span class="line">  .post-eof &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    margin: $post-eof-margin-top auto $post-eof-margin-bottom;</span><br><span class="line">    width: 0%;</span><br><span class="line">    height: 0px;</span><br><span class="line">    background: $grey-light;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="首页自动形成摘要"><a href="#首页自动形成摘要" class="headerlink" title="首页自动形成摘要"></a>首页自动形成摘要</h3><ul><li><p>主题配置文件，关键字：<code>auto_excerpt</code>，文章前150字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: true</span><br><span class="line">  length: 150</span><br></pre></td></tr></table></figure></li></ul><h2 id="写作样式"><a href="#写作样式" class="headerlink" title="写作样式"></a>写作样式</h2><h3 id="文内图片引用"><a href="#文内图片引用" class="headerlink" title="文内图片引用"></a>文内图片引用</h3><ul><li><p>站点配置文件，关键字：<code>post_asset_folder</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: true</span><br></pre></td></tr></table></figure></li><li><p>执行新建命令时会创建同名文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo n &lt;title&gt;</span><br></pre></td></tr></table></figure></li><li><p>将图片放入同名文件夹下，文章内图片相对引用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% asset_img 图片名称.jpg 图片描述 %&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="文内超链接"><a href="#文内超链接" class="headerlink" title="文内超链接"></a>文内超链接</h3><ul><li><p>文内超链接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[TextUrl](https://blog.jyusun.com/)</span><br></pre></td></tr></table></figure></li></ul><h2 id="博客功能"><a href="#博客功能" class="headerlink" title="博客功能"></a>博客功能</h2><h3 id="文章浏览显示进度百分比"><a href="#文章浏览显示进度百分比" class="headerlink" title="文章浏览显示进度百分比"></a>文章浏览显示进度百分比</h3><ul><li><p>主题配置文件，关键字： <code>scrollpercent</code> ，将 <code>false</code> 改为 <code>true</code> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Scroll percent label in b2t button.</span><br><span class="line">scrollpercent: true</span><br></pre></td></tr></table></figure></li><li><p>如果想要把百分比在左边显示，关键字：<code>b2t</code>将false改为true</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Back to top in sidebar (only for Pisces | Gemini).</span><br><span class="line">b2t: true</span><br></pre></td></tr></table></figure></li></ul><h3 id="开启版权声明"><a href="#开启版权声明" class="headerlink" title="开启版权声明"></a>开启版权声明</h3><ul><li><p>主题配置文件下，关键字 <code>creative_commons</code> </p><blockquote><p>creative_commons:<br>  license: by-nc-sa<br>  sidebar: true<br>  post: true<br>  language: zh-CN</p></blockquote></li></ul><h3 id="打赏功能"><a href="#打赏功能" class="headerlink" title="打赏功能"></a>打赏功能</h3><ul><li><p>文章底部打赏共功能，关键字：<code>Reward</code>。把二维码图片放入 <code>主题/source/images</code> 下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reward:</span><br><span class="line">  wechatpay: /images/wechatpay.jpg</span><br><span class="line">  alipay: /images/alipay.jpg</span><br></pre></td></tr></table></figure></li><li><p>禁止鼠标悬浮二维码上底部文字抖动，主题配置文件：，关键字：<code>animation</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Reward (Donate)</span><br><span class="line">reward_settings:</span><br><span class="line">  # If true, reward would be displayed in every article by default.</span><br><span class="line">  # You can show or hide reward in a specific article throuth `reward: true | false` in Front Matter.</span><br><span class="line">  enable: true</span><br><span class="line">  animation: false</span><br><span class="line">  comment: 坚持原创技术分享，您的支持将鼓励我继续创作！</span><br></pre></td></tr></table></figure></li></ul><h3 id="评论功能"><a href="#评论功能" class="headerlink" title="评论功能"></a>评论功能</h3><h3 id="在线沟通"><a href="#在线沟通" class="headerlink" title="在线沟通"></a>在线沟通</h3><ul><li><p><code>主题/layout/_partials/head/</code>，新增文件<code>daovoice.swig</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.daovoice %&#125;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">  (function(i,s,o,g,r,a,m)&#123;i[&quot;DaoVoiceObject&quot;]=r;i[r]=i[r]||function()&#123;(i[r].q=i[r].q||[]).push(arguments)&#125;,i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset=&quot;utf-8&quot;;m.parentNode.insertBefore(a,m)&#125;)(window,document,&quot;script&quot;,(&apos;https:&apos; == document.location.protocol ? &apos;https:&apos; : &apos;http:&apos;) + &quot;//widget.daovoice.io/widget/0f81ff2f.js&quot;,&quot;daovoice&quot;)</span><br><span class="line">  daovoice(&apos;init&apos;, &#123;</span><br><span class="line">      app_id: &quot;&#123;&#123;theme.daovoice.appid&#125;&#125;&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">  daovoice(&apos;update&apos;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>主题/layout/_partials/head/head.swig</code>添加引用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.daovoice.enable %&#125;</span><br><span class="line">&#123;% include &apos;daovoice.swig&apos; %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>主题配置文件，新增内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">daovoice:</span><br><span class="line">  enable: true</span><br><span class="line">  appid: asdqw5 #你的id</span><br></pre></td></tr></table></figure></li></ul><h3 id="分享功能"><a href="#分享功能" class="headerlink" title="分享功能"></a>分享功能</h3><ul><li><p>主题配置文件，关键字：<code>baidushare</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baidushare：</span><br><span class="line">  type: button</span><br><span class="line">  baidushare: true</span><br></pre></td></tr></table></figure></li></ul><h3 id="文章内链接文本样式"><a href="#文章内链接文本样式" class="headerlink" title="文章内链接文本样式"></a>文章内链接文本样式</h3><ul><li><p>修改文件<code>主题/source/css/_common/components/post/post.styl</code>，在末尾添加css样式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.post-body p a&#123;</span><br><span class="line">  color: #0593d3;</span><br><span class="line">  border-bottom: none;</span><br><span class="line">  border-bottom: 1px solid #0593d3;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    color: #fc6423;</span><br><span class="line">    border-bottom: none;</span><br><span class="line">    border-bottom: 1px solid #fc6423;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>其中选择.post-body 是为了不影响标题，选择 p 是为了不影响首页“阅读全文”的显示样式,颜色可以自己定义。</p><h3 id="博文压缩"><a href="#博文压缩" class="headerlink" title="博文压缩"></a>博文压缩</h3><ul><li>安装gulp</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install gulp -g</span><br><span class="line">$ npm install gulp-minify-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp --save</span><br></pre></td></tr></table></figure><ul><li>hexo主目录下新建gulpfile.js文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">var gulp = require(&apos;gulp&apos;);</span><br><span class="line">var minifycss = require(&apos;gulp-minify-css&apos;);</span><br><span class="line">var uglify = require(&apos;gulp-uglify&apos;);</span><br><span class="line">var htmlmin = require(&apos;gulp-htmlmin&apos;);</span><br><span class="line">var htmlclean = require(&apos;gulp-htmlclean&apos;);</span><br><span class="line">// 压缩 public 目录 css</span><br><span class="line">gulp.task(&apos;minify-css&apos;, function() &#123;</span><br><span class="line">    return gulp.src(&apos;./public/**/*.css&apos;)</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(gulp.dest(&apos;./public&apos;));</span><br><span class="line">&#125;);</span><br><span class="line">// 压缩 public 目录 html</span><br><span class="line">gulp.task(&apos;minify-html&apos;, function() &#123;</span><br><span class="line">  return gulp.src(&apos;./public/**/*.html&apos;)</span><br><span class="line">    .pipe(htmlclean())</span><br><span class="line">    .pipe(htmlmin(&#123;</span><br><span class="line">         removeComments: true,</span><br><span class="line">         minifyJS: true,</span><br><span class="line">         minifyCSS: true,</span><br><span class="line">         minifyURLs: true,</span><br><span class="line">    &#125;))</span><br><span class="line">    .pipe(gulp.dest(&apos;./public&apos;))</span><br><span class="line">&#125;);</span><br><span class="line">// 压缩 public/js 目录 js</span><br><span class="line">gulp.task(&apos;minify-js&apos;, function() &#123;</span><br><span class="line">    return gulp.src(&apos;./public/**/*.js&apos;)</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        .pipe(gulp.dest(&apos;./public&apos;));</span><br><span class="line">&#125;);</span><br><span class="line">// 执行 gulp 命令时执行的任务</span><br><span class="line">gulp.task(&apos;default&apos;, [</span><br><span class="line">    &apos;minify-html&apos;,&apos;minify-css&apos;,&apos;minify-js&apos;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>生成博文是执行 hexo g &amp;&amp; gulp 就会根据 gulpfile.js 中的配置，对 public 目录中的静态资源文件进行压缩。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hexo-Next7-0主题博客优化&quot;&gt;&lt;a href=&quot;#Hexo-Next7-0主题博客优化&quot; class=&quot;headerlink&quot; title=&quot;Hexo-Next7.0主题博客优化&quot;&gt;&lt;/a&gt;Hexo-Next7.0主题博客优化&lt;/h1&gt;&lt;h2 id=&quot;基
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="个人博客" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    
      <category term="hexo" scheme="https://blog.jyusun.com/tags/hexo/"/>
    
      <category term="next" scheme="https://blog.jyusun.com/tags/next/"/>
    
  </entry>
  
  <entry>
    <title>基于Docker搭建Gitlab社区版</title>
    <link href="https://blog.jyusun.com/contents/20190316102007.html"/>
    <id>https://blog.jyusun.com/contents/20190316102007.html</id>
    <published>2019-03-16T02:20:07.000Z</published>
    <updated>2020-02-12T09:41:52.409Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基于Docker搭建Gitlab社区版"><a href="#基于Docker搭建Gitlab社区版" class="headerlink" title="基于Docker搭建Gitlab社区版"></a>基于Docker搭建Gitlab社区版</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>之前搭建Gitlab是直接在服务器上搭建的，本次基于Docker对Gitlab服务搭建及使用进行了整理。</li></ul><h2 id="搜索和拉取镜像"><a href="#搜索和拉取镜像" class="headerlink" title="搜索和拉取镜像"></a>搜索和拉取镜像</h2><ul><li><p>在远端仓库中搜索Gitlab</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search gitlab</span><br></pre></td></tr></table></figure></li><li><p>拉取最新镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull gitlab/gitlab-ce</span><br></pre></td></tr></table></figure></li></ul><h2 id="运行镜像及配置"><a href="#运行镜像及配置" class="headerlink" title="运行镜像及配置"></a>运行镜像及配置</h2><h3 id="新建数据挂载路径"><a href="#新建数据挂载路径" class="headerlink" title="新建数据挂载路径"></a>新建数据挂载路径</h3><ul><li><p>新建配置文件挂载文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/gitlab/etc</span><br></pre></td></tr></table></figure></li><li><p>新建日志挂载文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/gitlab/logs</span><br></pre></td></tr></table></figure></li><li><p>新建数据挂载文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/gitlab/data</span><br></pre></td></tr></table></figure></li></ul><h3 id="运行Gitlab镜像"><a href="#运行Gitlab镜像" class="headerlink" title="运行Gitlab镜像"></a>运行Gitlab镜像</h3><ul><li><p>运行Gitlab镜像并指定相关配置地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --detach \</span><br><span class="line">    --name gitlab \</span><br><span class="line">    --hostname 192.168.233.201:9999 \</span><br><span class="line">    --publish 2222:22 \</span><br><span class="line">    --publish 8443:443 \</span><br><span class="line">    --publish 9998:80 \</span><br><span class="line">    --publish 9999:9999 \</span><br><span class="line">    --restart always \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    -v /var/gitlab/etc:/etc/gitlab \</span><br><span class="line">    -v /var/gitlab/logs:/var/log/gitlab \</span><br><span class="line">    -v /var/gitlab/data:/var/opt/gitlab \</span><br><span class="line">    gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure><p>注：初次启动需要初始化配置，启动稍慢2~3分钟，访问报502错误稍等一会再次刷新即可</p><blockquote><p>docker run \<br> –detach \ #后台运行<br> –name gitlab \ #镜像名称<br> –hostname 192.168.233.201:9999 \ #容器主机名称，如不配置会默认为DockerID 此时仓库地址会存在问题<br> –publish 2222:22 \  #内部sshd服务端口<br> –publish 8443:443 \ #https端口<br> –publish 9999:9999 \ #访问端口映射，仓库也可以配置单独的外部地址<br> –restart always \<br> –restart unless-stopped \<br> -v /var/gitlab/etc:/etc/gitlab \      #配置文件<br> -v /var/gitlab/logs:/var/log/gitlab \ #日志文件<br> -v /var/gitlab/data:/var/opt/gitlab \ #数据存储<br> gitlab/gitlab-ce:latest   #官方镜像源</p></blockquote></li></ul><h3 id="配置文件（未指定hostname时）"><a href="#配置文件（未指定hostname时）" class="headerlink" title="配置文件（未指定hostname时）"></a>配置文件（未指定hostname时）</h3><ul><li><p>启动效果，资源仓库地址为dockerid，需要调整</p><img src="/contents/20190316102007/dockerid.jpg" title="访问地址展示为dockerid"></li><li><p>编辑gitlab.rb配置仓库访问地址，默认初始化为docker的host，需要改为外部地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -t -i gitlab vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure><blockquote><p>external_url <span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMjMzLjIwMTo5OTk5" title="http://192.168.233.201:9999">http://192.168.233.201:9999<i class="fa fa-external-link"></i></span></p></blockquote><img src="/contents/20190316102007/external_url.jpg" title="访问地址"></li><li><p>修改完成，重新生成配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -t -i gitlab gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><p>注：网上大多数都是说<code>/var/gitlab/data/gitlab-rails/etc/gitlab.yml</code>文件，此文件是根据<code>gitlab.rb</code>生成的，直接修改此文件如果重新生成配置，修改就会被覆盖，如图所示</p><img src="/contents/20190316102007/gitlabyml.jpg" title="gitlabyml说明"></li></ul><h2 id="基础使用教程"><a href="#基础使用教程" class="headerlink" title="基础使用教程"></a>基础使用教程</h2><ul><li><p>访问Gitlab服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.233.201:9999</span><br></pre></td></tr></table></figure></li></ul><h3 id="基础设置及展示"><a href="#基础设置及展示" class="headerlink" title="基础设置及展示"></a>基础设置及展示</h3><ul><li><p>首次访问会让我们初始化root密码</p><img src="/contents/20190316102007/initpass.jpg" title="初始化root密码"></li><li><p>登陆root用户</p><img src="/contents/20190316102007/login.jpg" title="登陆"></li><li><p>默认首页展示</p><img src="/contents/20190316102007/index.jpg" title="首页"></li></ul><h3 id="新建项目组"><a href="#新建项目组" class="headerlink" title="新建项目组"></a>新建项目组</h3><ul><li><p>作用：对项目、对人员可以进行分组管理</p></li><li><p>点击创建组按钮</p><img src="/contents/20190316102007/creategroup.jpg" title="创建组"></li><li><p>添加组信息</p><img src="/contents/20190316102007/addgroup.jpg" title="添加组信息"></li><li><p>组中还可以在细分建立子分组或项目（必须对组拥有owner权限用户才可以）</p><img src="/contents/20190316102007/groupnew.jpg" title="添加子信息"></li></ul><h3 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h3><ul><li><p>点击创建项目按钮</p><img src="/contents/20190316102007/createproject.jpg" title="创建项目"><p>注：也可以直接在分组中选择New project</p></li><li><p>选择组并填写相关信息</p><img src="/contents/20190316102007/createproject.jpg" title="添加项目"></li></ul><h3 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h3><ul><li>一般公司内部会关闭注册功能</li></ul><h3 id="管理员新建用户"><a href="#管理员新建用户" class="headerlink" title="管理员新建用户"></a>管理员新建用户</h3><ul><li><p>点击新建用户按钮</p><img src="/contents/20190316102007/createuser.jpg" title="创建用户"></li><li><p>添加相关信息创建用户</p><img src="/contents/20190316102007/adduser.jpg" title="添加用户"></li></ul><h3 id="将用户添加到组"><a href="#将用户添加到组" class="headerlink" title="将用户添加到组"></a>将用户添加到组</h3><ul><li><p>将用户添加到组中，使其对组内项目有使用权限</p><img src="/contents/20190316102007/groupauthuser.jpg"></li></ul><h3 id="项目授权"><a href="#项目授权" class="headerlink" title="项目授权"></a>项目授权</h3><ul><li>待续…</li></ul><h3 id="上传项目"><a href="#上传项目" class="headerlink" title="上传项目"></a>上传项目</h3><ul><li>待续…</li></ul><h3 id="下载项目"><a href="#下载项目" class="headerlink" title="下载项目"></a>下载项目</h3><ul><li>待续…</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;基于Docker搭建Gitlab社区版&quot;&gt;&lt;a href=&quot;#基于Docker搭建Gitlab社区版&quot; class=&quot;headerlink&quot; title=&quot;基于Docker搭建Gitlab社区版&quot;&gt;&lt;/a&gt;基于Docker搭建Gitlab社区版&lt;/h1&gt;&lt;h2 i
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="程序安装" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85/"/>
    
    
      <category term="gitlab" scheme="https://blog.jyusun.com/tags/gitlab/"/>
    
      <category term="gitlab-ce" scheme="https://blog.jyusun.com/tags/gitlab-ce/"/>
    
  </entry>
  
  <entry>
    <title>大数据学习-Hadoop-高可用（HA）集群搭建</title>
    <link href="https://blog.jyusun.com/contents/20190228112031.html"/>
    <id>https://blog.jyusun.com/contents/20190228112031.html</id>
    <published>2019-02-28T03:19:31.000Z</published>
    <updated>2019-02-28T03:19:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hadoop-高可用（HA）集群搭建"><a href="#Hadoop-高可用（HA）集群搭建" class="headerlink" title="Hadoop-高可用（HA）集群搭建"></a>Hadoop-高可用（HA）集群搭建</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>test</li></ul><h2 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h2><h3 id="软件及环境准备"><a href="#软件及环境准备" class="headerlink" title="软件及环境准备"></a>软件及环境准备</h3><table><thead><tr><th>软件名称</th><th>版本</th><th>描述</th></tr></thead><tbody><tr><td>VirtualBox或VMware</td><td>14</td><td></td></tr><tr><td>CentOS7</td><td>7.5</td><td></td></tr><tr><td>JDK</td><td>1.8</td><td></td></tr><tr><td>Hadoop</td><td>3.1.2</td><td>hadoop-3.1.2.tar.gz</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="机器节点规划"><a href="#机器节点规划" class="headerlink" title="机器节点规划"></a>机器节点规划</h3><ul><li>Hadoop五个节点HA规划</li></ul><table><thead><tr><th>HostName</th><th style="text-align:left">IP</th><th>NameNode</th><th>DataNode</th><th>ZooKeeper</th><th>ZKFC</th><th>JouaryNode</th></tr></thead><tbody><tr><td>node1</td><td style="text-align:left">192.168.233.101</td><td>*</td><td></td><td></td><td>*</td><td></td></tr><tr><td>node2</td><td style="text-align:left">192.168.233.102</td><td>*</td><td></td><td></td><td>*</td><td></td></tr><tr><td>node3</td><td style="text-align:left">192.168.233.103</td><td></td><td>*</td><td>*</td><td></td><td>*</td></tr><tr><td>node4</td><td style="text-align:left">192.168.233.104</td><td></td><td>*</td><td>*</td><td></td><td>*</td></tr><tr><td>node5</td><td style="text-align:left">192.168.233.105</td><td></td><td>*</td><td>*</td><td></td><td>*</td></tr></tbody></table><p>注：ZooKeeper和JouaryNode是可以共享的</p><h3 id="相关路径创建"><a href="#相关路径创建" class="headerlink" title="相关路径创建"></a>相关路径创建</h3><ul><li>基础软件安装配置路径</li></ul><table><thead><tr><th>路径</th><th>注释</th></tr></thead><tbody><tr><td>/opt/basics</td><td>基础路径</td></tr><tr><td>/opt/basics/java/</td><td>JDK路径</td></tr><tr><td>/opt/bigdata/hadoop/</td><td>Hadoop路径</td></tr><tr><td>/opt/bigdata/zookeeper/</td><td>ZooKeeper安装路径</td></tr></tbody></table><h2 id="系统基础配置（root用户）"><a href="#系统基础配置（root用户）" class="headerlink" title="系统基础配置（root用户）"></a>系统基础配置（root用户）</h2><h3 id="基本组件安装"><a href="#基本组件安装" class="headerlink" title="基本组件安装"></a>基本组件安装</h3><ul><li><p>安装net-tools vim wge ntp 等基础工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y net-tools vim* wget ntp telnet</span><br></pre></td></tr></table></figure><p>注：如果系统是最小化安装的，以上工具组件可能没有集成，需要另外安装</p></li></ul><h3 id="设置HostName和Hosts"><a href="#设置HostName和Hosts" class="headerlink" title="设置HostName和Hosts"></a>设置HostName和Hosts</h3><ul><li><p><a href="http://blog.jyusun.com/contents/20190213131719.html">链接-CentOS7设置hostname和hosts</a></p></li><li><p>根据规划将下面内容写入hosts</p><blockquote><p>192.168.233.101 node1<br>192.168.233.102 node2<br>192.168.233.103 node3<br>192.168.233.104 node4<br>192.168.233.105 node5</p></blockquote></li></ul><h3 id="关闭SELINUX"><a href="#关闭SELINUX" class="headerlink" title="关闭SELINUX"></a>关闭SELINUX</h3><ul><li><p>临时关闭</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></li><li><p>永久关闭</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure><blockquote><p>SELINUX=disabled          #将SELINUX的值由enforcing改为disabled</p></blockquote></li></ul><h3 id="设置静态IP地址"><a href="#设置静态IP地址" class="headerlink" title="设置静态IP地址"></a>设置静态IP地址</h3><ul><li><p><a href="http://blog.jyusun.com/contents/20190217112031.html">链接-设置静态IP地址</a></p><p>注：IP根据自己的节点规划进行相应的配置</p></li></ul><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><ul><li><a href="http://blog.jyusun.com/contents/20190218122031.html">链接-关闭防火墙</a></li></ul><h3 id="配置免密登陆"><a href="#配置免密登陆" class="headerlink" title="配置免密登陆"></a>配置免密登陆</h3><ul><li><p><a href="http://blog.jyusun.com/contents/20190218182031.html">链接-配置免密登陆</a></p><p>需要免密钥的两种场景：</p><blockquote><ol><li><p>管理脚本：远程管理其他节点启停服务时需要免密钥</p></li><li><p>NameNode：搭建HA的时候，需要免密钥控制对方和自己</p></li></ol></blockquote></li></ul><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="JDK环境配置"><a href="#JDK环境配置" class="headerlink" title="JDK环境配置"></a>JDK环境配置</h3><ul><li><a href="http://blog.jyusun.com/contents/20190219202025.html">链接-Linux安装配置JDK1.8</a></li></ul><h3 id="ZooKeeper分布式集群搭建配置"><a href="#ZooKeeper分布式集群搭建配置" class="headerlink" title="ZooKeeper分布式集群搭建配置"></a>ZooKeeper分布式集群搭建配置</h3><ul><li><p><a href="http://blog.jyusun.com/contents/20190220202125.html">链接-Linux下ZooKeeper分布式集群搭建</a></p><p>注：根据节点规划，调整相应的配置</p></li></ul><h2 id="Hadoop相关配置"><a href="#Hadoop相关配置" class="headerlink" title="Hadoop相关配置"></a>Hadoop相关配置</h2><h3 id="安装及环境变量配置"><a href="#安装及环境变量配置" class="headerlink" title="安装及环境变量配置"></a>安装及环境变量配置</h3><ul><li><p>创建Hadoop路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/basics/hadoop/</span><br></pre></td></tr></table></figure></li><li><p>将事先准备好的hadoop-3.1.2.tar.gz文件上传至/opt/basics/hadoop路径</p></li><li><p>执行解压命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf hadoop-3.1.2.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>配置环境变量，在末尾追加hadoop相关配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><blockquote><p>HADOOP_HOME=/opt/basics/hadoop/hadoop-3.1.2<br>HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop<br>YARN_CONF_DIR=$HADOOP_HOME/etc/hadoop<br>PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH<br>export HADOOP_HOME HADOOP_CONF_DIR YARN_CONF_DIR PATH</p></blockquote></li><li><p>使配置立即生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure></li><li><p>验证是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop version</span><br></pre></td></tr></table></figure></li></ul><h3 id="Hadoop配置"><a href="#Hadoop配置" class="headerlink" title="Hadoop配置"></a>Hadoop配置</h3><ul><li><p>切换到hadoop路径下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME/etc/hadoop</span><br></pre></td></tr></table></figure><p>注：本章节下文配置均在此目录中</p><p>| 涉及文件      | 描述                      |<br>| ————- | ————————- |<br>| hadoop-env.sh |                           |<br>| core-site.xml |                           |<br>| workers       | DataNode节点信息          |<br>| hdfs-site.xml | SecondaryNameNode相应内容 |<br>|               |                           |<br>|               |                           |</p><p>​        </p></li><li><p>编辑core-site.xml文件，配置NameNode相应内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi core-site.xml</span><br></pre></td></tr></table></figure><blockquote><configuration><br>        <!-- 指定namenode的地址--><br>        <property><br>                <name>fs.defaultFS</name><br>                <value>hdfs://node1:9000</value><br>        </property><br>        <!-- 临时目录设定，为hadoop文件基础路径 --><br>        <property><br>                <name>hadoop.tmp.dir</name><br>                <value>/var/bigdata/hdfs/full</value><br>        </property><br>        <!-- 流文件缓冲区 4K --><br>        <property><br>                <name>io.file.buffer.size</name><br>                <value>4096</value><br>        </property><br></configuration></blockquote></li><li><p>编辑workers文件，配置DataNode相应内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi workers</span><br></pre></td></tr></table></figure><blockquote><p>node3</p><p>node4</p><p>node5</p></blockquote></li><li><p>编辑hdfs-site.xml文件，配置SecondaryNameNode相应内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi hdfs-site.xml</span><br></pre></td></tr></table></figure><blockquote><configuration><br>        <!-- 配置系统自动数据备份数量为3份（默认是3份） --><br>        <property><br>                <name>dfs.replication</name><br>                <value>3</value><br>        </property><br>        <!-- SecondaryNameNode地址 配置为节点2 --><br>        <property><br>                <name>dfs.namenode.secondary.http-address</name><br>                <value>node2:9001</value><br>        </property><br>        <!-- 不区分端口，直接使用namenode的IP和端口进行所有的webhdfs操作 --><br>        <property><br>                <name>dfs.webhdfs.enabled</name><br>                <value>true</value><br>        </property><br></configuration></blockquote></li></ul><h2 id="格式化NameNode"><a href="#格式化NameNode" class="headerlink" title="格式化NameNode"></a>格式化NameNode</h2><ul><li><p>执行格式化NameNode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure></li><li><p>启动hdfs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh</span><br></pre></td></tr></table></figure></li></ul><h2 id="访问hdfs"><a href="#访问hdfs" class="headerlink" title="访问hdfs"></a>访问hdfs</h2><ul><li><p>访问下面地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.233.101:9870</span><br></pre></td></tr></table></figure><p>注：Hadoop从3.1.0开始hdfs默认访问端口从50070改为9870</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hadoop-高可用（HA）集群搭建&quot;&gt;&lt;a href=&quot;#Hadoop-高可用（HA）集群搭建&quot; class=&quot;headerlink&quot; title=&quot;Hadoop-高可用（HA）集群搭建&quot;&gt;&lt;/a&gt;Hadoop-高可用（HA）集群搭建&lt;/h1&gt;&lt;h2 id=&quot;前
      
    
    </summary>
    
      <category term="技术实践" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"/>
    
      <category term="BigData" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/BigData/"/>
    
      <category term="Hadoop" scheme="https://blog.jyusun.com/categories/%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/BigData/Hadoop/"/>
    
    
      <category term="hadoop" scheme="https://blog.jyusun.com/tags/hadoop/"/>
    
      <category term="搭建" scheme="https://blog.jyusun.com/tags/%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>Linux下ZooKeeper分布式集群搭建</title>
    <link href="https://blog.jyusun.com/contents/20190220202125.html"/>
    <id>https://blog.jyusun.com/contents/20190220202125.html</id>
    <published>2019-02-20T12:21:25.000Z</published>
    <updated>2019-02-20T12:21:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ZooKeeper分布式集群搭建"><a href="#ZooKeeper分布式集群搭建" class="headerlink" title="ZooKeeper分布式集群搭建"></a>ZooKeeper分布式集群搭建</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>test</li></ul><h2 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h2><h3 id="软件及环境准备"><a href="#软件及环境准备" class="headerlink" title="软件及环境准备"></a>软件及环境准备</h3><table><thead><tr><th>软件名称</th><th>版本</th><th>描述</th></tr></thead><tbody><tr><td>CentOS</td><td>7.5</td><td>虚拟机节点3个且配置了JDK环境- <a href="https://blog.jyusun.com/contents/20190219202025.html">Linux安装配置JDK1.8</a> （zookeeper需要依赖jdk）</td></tr><tr><td>zookeeper</td><td>3.4.13</td><td>zookeeper-3.4.13.tar.gz</td></tr></tbody></table><h3 id="机器节点规划"><a href="#机器节点规划" class="headerlink" title="机器节点规划"></a>机器节点规划</h3><table><thead><tr><th>HostName</th><th>IP</th><th>描述</th></tr></thead><tbody><tr><td>zknode1</td><td>192.168.233.101</td><td>第一个节点</td></tr><tr><td>zknode2</td><td>192.168.233.102</td><td>第二个节点</td></tr><tr><td>zknode3</td><td>192.168.233.103</td><td>第三个节点</td></tr></tbody></table><p>注：根据规划为每个节点配置相应的HostName及IP地址</p><h3 id="相关路径创建"><a href="#相关路径创建" class="headerlink" title="相关路径创建"></a>相关路径创建</h3><ul><li><p>创建zookeeper安装路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/basics/zookeeper/</span><br></pre></td></tr></table></figure></li><li><p>创建zookeeper数据存储路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/udata/zookeeper/</span><br></pre></td></tr></table></figure><p>注：由于zookeeper默认数据存储路径为/tmp下，所以我们需要调整数据存储路径</p></li></ul><h2 id="软件解压缩安装"><a href="#软件解压缩安装" class="headerlink" title="软件解压缩安装"></a>软件解压缩安装</h2><h3 id="将软件包上传至系统中"><a href="#将软件包上传至系统中" class="headerlink" title="将软件包上传至系统中"></a>将软件包上传至系统中</h3><ul><li>将下载好的软件包传至/opt/basics/zookeeper/目录中</li></ul><h3 id="解压缩包"><a href="#解压缩包" class="headerlink" title="解压缩包"></a>解压缩包</h3><ul><li><p>切换到上传路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/basics/zookeeper/</span><br></pre></td></tr></table></figure></li><li><p>解压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf zookeeper-3.4.13.tar.gz</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置环境变量-每个节点都需要配置"><a href="#配置环境变量-每个节点都需要配置" class="headerlink" title="配置环境变量(每个节点都需要配置)"></a>配置环境变量(每个节点都需要配置)</h2><h3 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h3><ul><li><a href="http://blog.jyusun.com/contents/2019-02-18/20190218-120022/">Linux环境变量配置文件总结</a></li></ul><h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><ul><li><p>编辑.bashrc文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bashrc</span><br></pre></td></tr></table></figure></li><li><p>将以下文内容粘贴至配置文件末尾</p><blockquote><p>ZOOKEEPER_HOME=/opt/basics/zookeeper/zookeeper-3.4.13<br>PATH=$ZOOKEEPER_HOME/bin:$PATH<br>export ZOOKEEPER_HOME PATH</p></blockquote></li></ul><h3 id="使修改立即生效"><a href="#使修改立即生效" class="headerlink" title="使修改立即生效"></a>使修改立即生效</h3><ul><li><p>配置文件如果有改动，需要执行一下source命令让文件生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure></li></ul><h2 id="ZooKeeper配置"><a href="#ZooKeeper配置" class="headerlink" title="ZooKeeper配置"></a>ZooKeeper配置</h2><h3 id="复制配置文件"><a href="#复制配置文件" class="headerlink" title="复制配置文件"></a>复制配置文件</h3><ul><li><p>切换到zookeeper配置文件路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $ZOOKEEPER_HOME/conf</span><br></pre></td></tr></table></figure></li><li><p>复制zoo示例文件且重命名为zoo.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></li></ul><h3 id="文件zoo-cfg配置"><a href="#文件zoo-cfg配置" class="headerlink" title="文件zoo.cfg配置"></a>文件zoo.cfg配置</h3><ul><li><p>编辑配置文件zoo.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi zoo.cfg</span><br></pre></td></tr></table></figure><ol><li><p>修改dataDir属性指定上边创建的数据存储路径</p><blockquote><p>dataDir=/var/udata/zookeeper</p></blockquote></li><li><p>在文件的末尾根据节点规划进行配置</p><blockquote><p>server.1=zknode1:2888:3888<br>server.2=zknode2:2888:3888<br>server.3=zknode3:2888:3888</p></blockquote></li></ol><p>注：此步骤配置完成，可以将此包分发至其他节点当前路径，或在其他节点根据上面配置信息依次配置即可。</p></li><li><p>数据存储位置中为节点指定id信息写入myid文件中（每个节点需要单独操作）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /var/udata/zookeeper/myid</span><br></pre></td></tr></table></figure><p>注：不同的节点根据实际规划情况自行指定1、2、3</p></li></ul><h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><ul><li><p>命令：启动zk服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh status</span><br></pre></td></tr></table></figure></li><li><p>命令：查看zk状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh status</span><br></pre></td></tr></table></figure></li><li><p>命令：停止zk服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh stop</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ZooKeeper分布式集群搭建&quot;&gt;&lt;a href=&quot;#ZooKeeper分布式集群搭建&quot; class=&quot;headerlink&quot; title=&quot;ZooKeeper分布式集群搭建&quot;&gt;&lt;/a&gt;ZooKeeper分布式集群搭建&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="程序安装" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85/"/>
    
    
      <category term="zookeeper" scheme="https://blog.jyusun.com/tags/zookeeper/"/>
    
      <category term="ZooKeeper分布式" scheme="https://blog.jyusun.com/tags/ZooKeeper%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Linux安装配置JDK1.8</title>
    <link href="https://blog.jyusun.com/contents/20190219202025.html"/>
    <id>https://blog.jyusun.com/contents/20190219202025.html</id>
    <published>2019-02-19T12:20:25.000Z</published>
    <updated>2019-02-19T12:20:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux安装配置JDK"><a href="#Linux安装配置JDK" class="headerlink" title="Linux安装配置JDK"></a>Linux安装配置JDK</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>JDK是 Java 语言的软件开发工具包，主要用于java应用程序。JDK是整个java开发的核心，它包含了JAVA的运行环境（JVM+Java系统类库）和JAVA工具，所以我们要运行一个JAVA程序的时候就要先安装一个JDK。下文主要以二进制的方式安装配置。</li></ul><h2 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h2><h3 id="软件及环境准备"><a href="#软件及环境准备" class="headerlink" title="软件及环境准备"></a>软件及环境准备</h3><table><thead><tr><th>软件名称</th><th>版本</th><th>描述</th></tr></thead><tbody><tr><td>JDK</td><td>jdk1.8.0_191</td><td>jdk-8u191-linux-x64.tar.gz</td></tr></tbody></table><h3 id="相关路径创建"><a href="#相关路径创建" class="headerlink" title="相关路径创建"></a>相关路径创建</h3><ul><li><p>创建jdk安装路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /opt/basics/java</span><br></pre></td></tr></table></figure></li></ul><h2 id="软件解压缩安装"><a href="#软件解压缩安装" class="headerlink" title="软件解压缩安装"></a>软件解压缩安装</h2><h3 id="将软件包上传至系统中"><a href="#将软件包上传至系统中" class="headerlink" title="将软件包上传至系统中"></a>将软件包上传至系统中</h3><ul><li>下载好的软件包传至/opt/basics/java目录中</li></ul><h3 id="解压缩包"><a href="#解压缩包" class="headerlink" title="解压缩包"></a>解压缩包</h3><ul><li><p>切换到上传路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd /opt/basics/java</span><br></pre></td></tr></table></figure></li><li><p>解压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tar -xvzf jdk-8u191-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><h3 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h3><ul><li><a href="http://blog.jyusun.com/contents/2019-02-18/20190218-120022/">Linux环境变量配置文件总结</a></li></ul><h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><ul><li><p>编辑.bashrc文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vi ~/.bashrc</span><br></pre></td></tr></table></figure></li><li><p>将以下文件粘贴至属性文件末尾</p><blockquote><p>JAVA_HOME=/opt/basics/java/jdk1.8.0_191<br>JRE_HOME=$JAVA_HOME/jre<br>CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br>PATH=$JAVA_HOME/bin:$PATH<br>export JAVA_HOME JRE_HOME CLASSPATH PATH</p></blockquote></li></ul><h3 id="使修改立即生效"><a href="#使修改立即生效" class="headerlink" title="使修改立即生效"></a>使修改立即生效</h3><ul><li><p>配置文件如果有变动，需要执行一下source命令让文件生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># source ~/.bashrc</span><br></pre></td></tr></table></figure></li></ul><h3 id="查看配置的环境变量"><a href="#查看配置的环境变量" class="headerlink" title="查看配置的环境变量"></a>查看配置的环境变量</h3><ul><li><p>查看是否可以读取到环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># echo $JAVA_HOME</span><br><span class="line"># echo $CLASSPATH</span><br><span class="line"># echo $PATH</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置完成，查看版本"><a href="#配置完成，查看版本" class="headerlink" title="配置完成，查看版本"></a>配置完成，查看版本</h2><ul><li><p>执行命令查看配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># java -version</span><br></pre></td></tr></table></figure><blockquote><p>java version “1.8.0_191”<br>Java(TM) SE Runtime Environment (build 1.8.0_191-b12)<br>Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</p></blockquote><p>注：也可以使用jps命令查看进程</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Linux安装配置JDK&quot;&gt;&lt;a href=&quot;#Linux安装配置JDK&quot; class=&quot;headerlink&quot; title=&quot;Linux安装配置JDK&quot;&gt;&lt;/a&gt;Linux安装配置JDK&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;
      
    
    </summary>
    
      <category term="环境部署" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
      <category term="程序安装" scheme="https://blog.jyusun.com/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85/"/>
    
    
      <category term="jdk" scheme="https://blog.jyusun.com/tags/jdk/"/>
    
      <category term="配置JDK" scheme="https://blog.jyusun.com/tags/%E9%85%8D%E7%BD%AEJDK/"/>
    
  </entry>
  
</feed>
